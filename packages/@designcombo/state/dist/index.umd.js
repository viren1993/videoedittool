(function(w,H){typeof exports=="object"&&typeof module<"u"?H(exports,require("@designcombo/events")):typeof define=="function"&&define.amd?define(["exports","@designcombo/events"],H):(w=typeof globalThis<"u"?globalThis:w||self,H(w.events={},w.events))})(this,function(w,H){"use strict";var Bo=Object.defineProperty;var Yo=(w,H,Ft)=>H in w?Bo(w,H,{enumerable:!0,configurable:!0,writable:!0,value:Ft}):w[H]=Ft;var Qt=(w,H,Ft)=>Yo(w,typeof H!="symbol"?H+"":H,Ft);var Ft=function(t,r){return Ft=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])},Ft(t,r)};function Be(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");Ft(t,r);function e(){this.constructor=t}t.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)}function Rr(t){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&t[r],n=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function Cr(t,r){var e=typeof Symbol=="function"&&t[Symbol.iterator];if(!e)return t;var n=e.call(t),s,a=[],u;try{for(;(r===void 0||r-- >0)&&!(s=n.next()).done;)a.push(s.value)}catch(c){u={error:c}}finally{try{s&&!s.done&&(e=n.return)&&e.call(n)}finally{if(u)throw u.error}}return a}function Pr(t,r,e){if(e||arguments.length===2)for(var n=0,s=r.length,a;n<s;n++)(a||!(n in r))&&(a||(a=Array.prototype.slice.call(r,0,n)),a[n]=r[n]);return t.concat(a||Array.prototype.slice.call(r))}typeof SuppressedError=="function"&&SuppressedError;function At(t){return typeof t=="function"}function Yn(t){var r=function(n){Error.call(n),n.stack=new Error().stack},e=t(r);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var xr=Yn(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,s){return s+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Lr(t,r){if(t){var e=t.indexOf(r);0<=e&&t.splice(e,1)}}var cr=function(){function t(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var r,e,n,s,a;if(!this.closed){this.closed=!0;var u=this._parentage;if(u)if(this._parentage=null,Array.isArray(u))try{for(var c=Rr(u),d=c.next();!d.done;d=c.next()){var p=d.value;p.remove(this)}}catch(b){r={error:b}}finally{try{d&&!d.done&&(e=c.return)&&e.call(c)}finally{if(r)throw r.error}}else u.remove(this);var h=this.initialTeardown;if(At(h))try{h()}catch(b){a=b instanceof xr?b.errors:[b]}var g=this._finalizers;if(g){this._finalizers=null;try{for(var m=Rr(g),I=m.next();!I.done;I=m.next()){var k=I.value;try{Xn(k)}catch(b){a=a??[],b instanceof xr?a=Pr(Pr([],Cr(a)),Cr(b.errors)):a.push(b)}}}catch(b){n={error:b}}finally{try{I&&!I.done&&(s=m.return)&&s.call(m)}finally{if(n)throw n.error}}}if(a)throw new xr(a)}},t.prototype.add=function(r){var e;if(r&&r!==this)if(this.closed)Xn(r);else{if(r instanceof t){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(r)}},t.prototype._hasParent=function(r){var e=this._parentage;return e===r||Array.isArray(e)&&e.includes(r)},t.prototype._addParent=function(r){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(r),e):e?[e,r]:r},t.prototype._removeParent=function(r){var e=this._parentage;e===r?this._parentage=null:Array.isArray(e)&&Lr(e,r)},t.prototype.remove=function(r){var e=this._finalizers;e&&Lr(e,r),r instanceof t&&r._removeParent(this)},t.EMPTY=function(){var r=new t;return r.closed=!0,r}(),t}(),Wn=cr.EMPTY;function Gn(t){return t instanceof cr||t&&"closed"in t&&At(t.remove)&&At(t.add)&&At(t.unsubscribe)}function Xn(t){At(t)?t():t.unsubscribe()}var Ei={Promise:void 0},wi={setTimeout:function(t,r){for(var e=[],n=2;n<arguments.length;n++)e[n-2]=arguments[n];return setTimeout.apply(void 0,Pr([t,r],Cr(e)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function Ai(t){wi.setTimeout(function(){throw t})}function Kn(){}function ur(t){t()}var Vn=function(t){Be(r,t);function r(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,Gn(e)&&e.add(n)):n.destination=Di,n}return r.create=function(e,n,s){return new zr(e,n,s)},r.prototype.next=function(e){this.isStopped||this._next(e)},r.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},r.prototype._next=function(e){this.destination.next(e)},r.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},r.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},r}(cr),Mi=function(){function t(r){this.partialObserver=r}return t.prototype.next=function(r){var e=this.partialObserver;if(e.next)try{e.next(r)}catch(n){lr(n)}},t.prototype.error=function(r){var e=this.partialObserver;if(e.error)try{e.error(r)}catch(n){lr(n)}else lr(r)},t.prototype.complete=function(){var r=this.partialObserver;if(r.complete)try{r.complete()}catch(e){lr(e)}},t}(),zr=function(t){Be(r,t);function r(e,n,s){var a=t.call(this)||this,u;return At(e)||!e?u={next:e??void 0,error:n??void 0,complete:s??void 0}:u=e,a.destination=new Mi(u),a}return r}(Vn);function lr(t){Ai(t)}function Oi(t){throw t}var Di={closed:!0,next:Kn,error:Oi,complete:Kn},Ri=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Ci(t){return t}function Pi(t){return t.length===0?Ci:t.length===1?t[0]:function(e){return t.reduce(function(n,s){return s(n)},e)}}var qn=function(){function t(r){r&&(this._subscribe=r)}return t.prototype.lift=function(r){var e=new t;return e.source=this,e.operator=r,e},t.prototype.subscribe=function(r,e,n){var s=this,a=Li(r)?r:new zr(r,e,n);return ur(function(){var u=s,c=u.operator,d=u.source;a.add(c?c.call(a,d):d?s._subscribe(a):s._trySubscribe(a))}),a},t.prototype._trySubscribe=function(r){try{return this._subscribe(r)}catch(e){r.error(e)}},t.prototype.forEach=function(r,e){var n=this;return e=Jn(e),new e(function(s,a){var u=new zr({next:function(c){try{r(c)}catch(d){a(d),u.unsubscribe()}},error:a,complete:s});n.subscribe(u)})},t.prototype._subscribe=function(r){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(r)},t.prototype[Ri]=function(){return this},t.prototype.pipe=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Pi(r)(this)},t.prototype.toPromise=function(r){var e=this;return r=Jn(r),new r(function(n,s){var a;e.subscribe(function(u){return a=u},function(u){return s(u)},function(){return n(a)})})},t.create=function(r){return new t(r)},t}();function Jn(t){var r;return(r=t??Ei.Promise)!==null&&r!==void 0?r:Promise}function xi(t){return t&&At(t.next)&&At(t.error)&&At(t.complete)}function Li(t){return t&&t instanceof Vn||xi(t)&&Gn(t)}var zi=Yn(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Zn=function(t){Be(r,t);function r(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return r.prototype.lift=function(e){var n=new Qn(this,this);return n.operator=e,n},r.prototype._throwIfClosed=function(){if(this.closed)throw new zi},r.prototype.next=function(e){var n=this;ur(function(){var s,a;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var u=Rr(n.currentObservers),c=u.next();!c.done;c=u.next()){var d=c.value;d.next(e)}}catch(p){s={error:p}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(s)throw s.error}}}})},r.prototype.error=function(e){var n=this;ur(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=e;for(var s=n.observers;s.length;)s.shift().error(e)}})},r.prototype.complete=function(){var e=this;ur(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var n=e.observers;n.length;)n.shift().complete()}})},r.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(r.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),r.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},r.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},r.prototype._innerSubscribe=function(e){var n=this,s=this,a=s.hasError,u=s.isStopped,c=s.observers;return a||u?Wn:(this.currentObservers=null,c.push(e),new cr(function(){n.currentObservers=null,Lr(c,e)}))},r.prototype._checkFinalizedStatuses=function(e){var n=this,s=n.hasError,a=n.thrownError,u=n.isStopped;s?e.error(a):u&&e.complete()},r.prototype.asObservable=function(){var e=new qn;return e.source=this,e},r.create=function(e,n){return new Qn(e,n)},r}(qn),Qn=function(t){Be(r,t);function r(e,n){var s=t.call(this)||this;return s.destination=e,s.source=n,s}return r.prototype.next=function(e){var n,s;(s=(n=this.destination)===null||n===void 0?void 0:n.next)===null||s===void 0||s.call(n,e)},r.prototype.error=function(e){var n,s;(s=(n=this.destination)===null||n===void 0?void 0:n.error)===null||s===void 0||s.call(n,e)},r.prototype.complete=function(){var e,n;(n=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||n===void 0||n.call(e)},r.prototype._subscribe=function(e){var n,s;return(s=(n=this.source)===null||n===void 0?void 0:n.subscribe(e))!==null&&s!==void 0?s:Wn},r}(Zn),ts=function(t){Be(r,t);function r(e){var n=t.call(this)||this;return n._value=e,n}return Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),r.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return!n.closed&&e.next(this._value),n},r.prototype.getValue=function(){var e=this,n=e.hasError,s=e.thrownError,a=e._value;if(n)throw s;return this._throwIfClosed(),a},r.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},r}(Zn),ht=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Nr(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var dr={exports:{}};dr.exports,function(t,r){var e=200,n="__lodash_hash_undefined__",s=1,a=2,u=9007199254740991,c="[object Arguments]",d="[object Array]",p="[object AsyncFunction]",h="[object Boolean]",g="[object Date]",m="[object Error]",I="[object Function]",k="[object GeneratorFunction]",b="[object Map]",S="[object Number]",f="[object Null]",_="[object Object]",E="[object Promise]",T="[object Proxy]",M="[object RegExp]",v="[object Set]",A="[object String]",U="[object Symbol]",P="[object Undefined]",K="[object WeakMap]",D="[object ArrayBuffer]",F="[object DataView]",nt="[object Float32Array]",ce="[object Float64Array]",ue="[object Int8Array]",Ae="[object Int16Array]",Me="[object Int32Array]",Oe="[object Uint8Array]",De="[object Uint8ClampedArray]",z="[object Uint16Array]",Re="[object Uint32Array]",Ce=/[\\^$.*+?()[\]{}|]/g,at=/^\[object .+?Constructor\]$/,le=/^(?:0|[1-9]\d*)$/,N={};N[nt]=N[ce]=N[ue]=N[Ae]=N[Me]=N[Oe]=N[De]=N[z]=N[Re]=!0,N[c]=N[d]=N[D]=N[h]=N[F]=N[g]=N[m]=N[I]=N[b]=N[S]=N[_]=N[M]=N[v]=N[A]=N[K]=!1;var de=typeof ht=="object"&&ht&&ht.Object===Object&&ht,Pe=typeof self=="object"&&self&&self.Object===Object&&self,ot=de||Pe||Function("return this")(),fe=r&&!r.nodeType&&r,pe=fe&&!0&&t&&!t.nodeType&&t,Ht=pe&&pe.exports===fe,Ut=Ht&&de.process,he=function(){try{return Ut&&Ut.binding&&Ut.binding("util")}catch{}}(),jt=he&&he.isTypedArray;function me(i,o){for(var l=-1,y=i==null?0:i.length,R=0,O=[];++l<y;){var L=i[l];o(L,l,i)&&(O[R++]=L)}return O}function Bt(i,o){for(var l=-1,y=o.length,R=i.length;++l<y;)i[R+l]=o[l];return i}function ge(i,o){for(var l=-1,y=i==null?0:i.length;++l<y;)if(o(i[l],l,i))return!0;return!1}function xe(i,o){for(var l=-1,y=Array(i);++l<i;)y[l]=o(l);return y}function Le(i){return function(o){return i(o)}}function Mt(i,o){return i.has(o)}function Yt(i,o){return i==null?void 0:i[o]}function ye(i){var o=-1,l=Array(i.size);return i.forEach(function(y,R){l[++o]=[R,y]}),l}function Ie(i,o){return function(l){return i(o(l))}}function pt(i){var o=-1,l=Array(i.size);return i.forEach(function(y){l[++o]=y}),l}var Ot=Array.prototype,ze=Function.prototype,kt=Object.prototype,Dt=ot["__core-js_shared__"],Wt=ze.toString,st=kt.hasOwnProperty,be=function(){var i=/[^.]+$/.exec(Dt&&Dt.keys&&Dt.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}(),ke=kt.toString,Ne=RegExp("^"+Wt.call(st).replace(Ce,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Gt=Ht?ot.Buffer:void 0,Rt=ot.Symbol,_e=ot.Uint8Array,Ct=kt.propertyIsEnumerable,_t=Ot.splice,ct=Rt?Rt.toStringTag:void 0,Pt=Object.getOwnPropertySymbols,Xt=Gt?Gt.isBuffer:void 0,vt=Ie(Object.keys,Object),Kt=Lt(ot,"DataView"),St=Lt(ot,"Map"),Vt=Lt(ot,"Promise"),qt=Lt(ot,"Set"),tr=Lt(ot,"WeakMap"),Jt=Lt(Object,"create"),Ir=it(Kt),xt=it(St),on=it(Vt),cn=it(qt),un=it(tr),br=Rt?Rt.prototype:void 0,er=br?br.valueOf:void 0;function Z(i){var o=-1,l=i==null?0:i.length;for(this.clear();++o<l;){var y=i[o];this.set(y[0],y[1])}}function ln(){this.__data__=Jt?Jt(null):{},this.size=0}function dn(i){var o=this.has(i)&&delete this.__data__[i];return this.size-=o?1:0,o}function fn(i){var o=this.__data__;if(Jt){var l=o[i];return l===n?void 0:l}return st.call(o,i)?o[i]:void 0}function pn(i){var o=this.__data__;return Jt?o[i]!==void 0:st.call(o,i)}function hn(i,o){var l=this.__data__;return this.size+=this.has(i)?0:1,l[i]=Jt&&o===void 0?n:o,this}Z.prototype.clear=ln,Z.prototype.delete=dn,Z.prototype.get=fn,Z.prototype.has=pn,Z.prototype.set=hn;function tt(i){var o=-1,l=i==null?0:i.length;for(this.clear();++o<l;){var y=i[o];this.set(y[0],y[1])}}function mn(){this.__data__=[],this.size=0}function gn(i){var o=this.__data__,l=He(o,i);if(l<0)return!1;var y=o.length-1;return l==y?o.pop():_t.call(o,l,1),--this.size,!0}function yn(i){var o=this.__data__,l=He(o,i);return l<0?void 0:o[l][1]}function In(i){return He(this.__data__,i)>-1}function bn(i,o){var l=this.__data__,y=He(l,i);return y<0?(++this.size,l.push([i,o])):l[y][1]=o,this}tt.prototype.clear=mn,tt.prototype.delete=gn,tt.prototype.get=yn,tt.prototype.has=In,tt.prototype.set=bn;function ut(i){var o=-1,l=i==null?0:i.length;for(this.clear();++o<l;){var y=i[o];this.set(y[0],y[1])}}function kn(){this.size=0,this.__data__={hash:new Z,map:new(St||tt),string:new Z}}function _n(i){var o=yt(this,i).delete(i);return this.size-=o?1:0,o}function vn(i){return yt(this,i).get(i)}function Sn(i){return yt(this,i).has(i)}function Tn(i,o){var l=yt(this,i),y=l.size;return l.set(i,o),this.size+=l.size==y?0:1,this}ut.prototype.clear=kn,ut.prototype.delete=_n,ut.prototype.get=vn,ut.prototype.has=Sn,ut.prototype.set=Tn;function Fe(i){var o=-1,l=i==null?0:i.length;for(this.__data__=new ut;++o<l;)this.add(i[o])}function kr(i){return this.__data__.set(i,n),this}function $e(i){return this.__data__.has(i)}Fe.prototype.add=Fe.prototype.push=kr,Fe.prototype.has=$e;function Tt(i){var o=this.__data__=new tt(i);this.size=o.size}function rr(){this.__data__=new tt,this.size=0}function En(i){var o=this.__data__,l=o.delete(i);return this.size=o.size,l}function wn(i){return this.__data__.get(i)}function An(i){return this.__data__.has(i)}function Mn(i,o){var l=this.__data__;if(l instanceof tt){var y=l.__data__;if(!St||y.length<e-1)return y.push([i,o]),this.size=++l.size,this;l=this.__data__=new ut(y)}return l.set(i,o),this.size=l.size,this}Tt.prototype.clear=rr,Tt.prototype.delete=En,Tt.prototype.get=wn,Tt.prototype.has=An,Tt.prototype.set=Mn;function On(i,o){var l=Ue(i),y=!l&&Er(i),R=!l&&!y&&je(i),O=!l&&!y&&!R&&Mr(i),L=l||y||R||O,x=L?xe(i.length,String):[],W=x.length;for(var $ in i)st.call(i,$)&&!(L&&($=="length"||R&&($=="offset"||$=="parent")||O&&($=="buffer"||$=="byteLength"||$=="byteOffset")||Nn($,W)))&&x.push($);return x}function He(i,o){for(var l=i.length;l--;)if(Tr(i[l][0],o))return l;return-1}function nr(i,o,l){var y=o(i);return Ue(i)?y:Bt(y,l(i))}function ve(i){return i==null?i===void 0?P:f:ct&&ct in Object(i)?zt(i):Sr(i)}function _r(i){return wt(i)&&ve(i)==c}function vr(i,o,l,y,R){return i===o?!0:i==null||o==null||!wt(i)&&!wt(o)?i!==i&&o!==o:Dn(i,o,l,y,vr,R)}function Dn(i,o,l,y,R,O){var L=Ue(i),x=Ue(o),W=L?d:Et(i),$=x?d:Et(o);W=W==c?_:W,$=$==c?_:$;var et=W==_,lt=$==_,X=W==$;if(X&&je(i)){if(!je(o))return!1;L=!0,et=!1}if(X&&!et)return O||(O=new Tt),L||Mr(i)?sr(i,o,l,y,R,O):xn(i,o,W,l,y,R,O);if(!(l&s)){var rt=et&&st.call(i,"__wrapped__"),Q=lt&&st.call(o,"__wrapped__");if(rt||Q){var Zt=rt?i.value():i,Nt=Q?o.value():o;return O||(O=new Tt),R(Zt,Nt,l,y,O)}}return X?(O||(O=new Tt),Ln(i,o,l,y,R,O)):!1}function Rn(i){if(!Ar(i)||$n(i))return!1;var o=wr(i)?Ne:at;return o.test(it(i))}function Cn(i){return wt(i)&&ar(i.length)&&!!N[ve(i)]}function Pn(i){if(!Hn(i))return vt(i);var o=[];for(var l in Object(i))st.call(i,l)&&l!="constructor"&&o.push(l);return o}function sr(i,o,l,y,R,O){var L=l&s,x=i.length,W=o.length;if(x!=W&&!(L&&W>x))return!1;var $=O.get(i);if($&&O.get(o))return $==o;var et=-1,lt=!0,X=l&a?new Fe:void 0;for(O.set(i,o),O.set(o,i);++et<x;){var rt=i[et],Q=o[et];if(y)var Zt=L?y(Q,rt,et,o,i,O):y(rt,Q,et,i,o,O);if(Zt!==void 0){if(Zt)continue;lt=!1;break}if(X){if(!ge(o,function(Nt,Te){if(!Mt(X,Te)&&(rt===Nt||R(rt,Nt,l,y,O)))return X.push(Te)})){lt=!1;break}}else if(!(rt===Q||R(rt,Q,l,y,O))){lt=!1;break}}return O.delete(i),O.delete(o),lt}function xn(i,o,l,y,R,O,L){switch(l){case F:if(i.byteLength!=o.byteLength||i.byteOffset!=o.byteOffset)return!1;i=i.buffer,o=o.buffer;case D:return!(i.byteLength!=o.byteLength||!O(new _e(i),new _e(o)));case h:case g:case S:return Tr(+i,+o);case m:return i.name==o.name&&i.message==o.message;case M:case A:return i==o+"";case b:var x=ye;case v:var W=y&s;if(x||(x=pt),i.size!=o.size&&!W)return!1;var $=L.get(i);if($)return $==o;y|=a,L.set(i,o);var et=sr(x(i),x(o),y,R,O,L);return L.delete(i),et;case U:if(er)return er.call(i)==er.call(o)}return!1}function Ln(i,o,l,y,R,O){var L=l&s,x=Se(i),W=x.length,$=Se(o),et=$.length;if(W!=et&&!L)return!1;for(var lt=W;lt--;){var X=x[lt];if(!(L?X in o:st.call(o,X)))return!1}var rt=O.get(i);if(rt&&O.get(o))return rt==o;var Q=!0;O.set(i,o),O.set(o,i);for(var Zt=L;++lt<W;){X=x[lt];var Nt=i[X],Te=o[X];if(y)var Ti=L?y(Te,Nt,X,o,i,O):y(Nt,Te,X,i,o,O);if(!(Ti===void 0?Nt===Te||R(Nt,Te,l,y,O):Ti)){Q=!1;break}Zt||(Zt=X=="constructor")}if(Q&&!Zt){var Or=i.constructor,Dr=o.constructor;Or!=Dr&&"constructor"in i&&"constructor"in o&&!(typeof Or=="function"&&Or instanceof Or&&typeof Dr=="function"&&Dr instanceof Dr)&&(Q=!1)}return O.delete(i),O.delete(o),Q}function Se(i){return nr(i,or,zn)}function yt(i,o){var l=i.__data__;return Fn(o)?l[typeof o=="string"?"string":"hash"]:l.map}function Lt(i,o){var l=Yt(i,o);return Rn(l)?l:void 0}function zt(i){var o=st.call(i,ct),l=i[ct];try{i[ct]=void 0;var y=!0}catch{}var R=ke.call(i);return y&&(o?i[ct]=l:delete i[ct]),R}var zn=Pt?function(i){return i==null?[]:(i=Object(i),me(Pt(i),function(o){return Ct.call(i,o)}))}:jn,Et=ve;(Kt&&Et(new Kt(new ArrayBuffer(1)))!=F||St&&Et(new St)!=b||Vt&&Et(Vt.resolve())!=E||qt&&Et(new qt)!=v||tr&&Et(new tr)!=K)&&(Et=function(i){var o=ve(i),l=o==_?i.constructor:void 0,y=l?it(l):"";if(y)switch(y){case Ir:return F;case xt:return b;case on:return E;case cn:return v;case un:return K}return o});function Nn(i,o){return o=o??u,!!o&&(typeof i=="number"||le.test(i))&&i>-1&&i%1==0&&i<o}function Fn(i){var o=typeof i;return o=="string"||o=="number"||o=="symbol"||o=="boolean"?i!=="__proto__":i===null}function $n(i){return!!be&&be in i}function Hn(i){var o=i&&i.constructor,l=typeof o=="function"&&o.prototype||kt;return i===l}function Sr(i){return ke.call(i)}function it(i){if(i!=null){try{return Wt.call(i)}catch{}try{return i+""}catch{}}return""}function Tr(i,o){return i===o||i!==i&&o!==o}var Er=_r(function(){return arguments}())?_r:function(i){return wt(i)&&st.call(i,"callee")&&!Ct.call(i,"callee")},Ue=Array.isArray;function ir(i){return i!=null&&ar(i.length)&&!wr(i)}var je=Xt||Bn;function Un(i,o){return vr(i,o)}function wr(i){if(!Ar(i))return!1;var o=ve(i);return o==I||o==k||o==p||o==T}function ar(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=u}function Ar(i){var o=typeof i;return i!=null&&(o=="object"||o=="function")}function wt(i){return i!=null&&typeof i=="object"}var Mr=jt?Le(jt):Cn;function or(i){return ir(i)?On(i):Pn(i)}function jn(){return[]}function Bn(){return!1}t.exports=Un}(dr,dr.exports);var Ni=dr.exports;const B=Nr(Ni),Fi="add",es="track",rs="trackItems",$i=`${es}:changed`,Hi=`${rs}:changed`,ns="state",Ui=`${ns}:changed`,ss="bulk",Fr=`${ss}:edit`,fr="design",is=`${fr}:load`,as=`${fr}:resize`,j="add",os=`${j}:text`,cs=`${j}:video`,us=`${j}:audio`,ji=`${j}:placeholder`,ls=`${j}:image`,ds=`${j}:illustration`,fs=`${j}:shape`,Bi=`${j}:mask`,Yi=`${j}:transition`,ps=`${j}:animation`,hs=`${j}:caption`,ms=`${j}:template`,gs=`${j}:items`,ys=`${j}:composition`,Is=`${j}:progressBar`,bs=`${j}:progressFrame`,ks=`${j}:radialAudioBars`,_s=`${j}:linealAudioBars`,vs=`${j}:progressSquare`,Ss=`${j}:waveAudioBars`,Ts=`${j}:hillAudioBars`,Es=`${j}:rect`,It="edit",ws=`${It}:object`,As=`${It}:replaceMedia`,Wi=`${It}:text`,Gi=`${It}:shape`,Xi=`${It}:templateItem`,Ki=`${It}:deleteTemplateItem`,Ms=`${It}:backgroundEditor`,Os=`${It}:track`,Vi="enterEditMode",te="active",qi=`${te}:set`,Ji=`${te}:delete`,Ds=`${te}:paste`,Zi=`${te}:clone`,Rs=`${te}:split`,V="layer",Qi=`${V}:locked`,ta=`${V}:hidden`,ea=`${V}:move`,Cs=`${V}:select`,ra=`${V}:selection`,na=`${V}:sendTo`,sa=`${V}:rename`,ia=`${V}:editingName`,Ps=`${V}:copy`,aa=`${V}:paste`,xs=`${V}:clone`,oa=`${V}:split`,ca=`${V}:cut`,Ls=`${V}:delete`,zs=`${V}:replace`,Ye="history",Ns=`${Ye}:undo`,Fs=`${Ye}:redo`,ua=`${Ye}:reset`,$r="scale",$s=`${$r}:changed`;var pr={exports:{}};pr.exports,function(t,r){var e=200,n="__lodash_hash_undefined__",s=9007199254740991,a="[object Arguments]",u="[object Array]",c="[object Boolean]",d="[object Date]",p="[object Error]",h="[object Function]",g="[object GeneratorFunction]",m="[object Map]",I="[object Number]",k="[object Object]",b="[object Promise]",S="[object RegExp]",f="[object Set]",_="[object String]",E="[object Symbol]",T="[object WeakMap]",M="[object ArrayBuffer]",v="[object DataView]",A="[object Float32Array]",U="[object Float64Array]",P="[object Int8Array]",K="[object Int16Array]",D="[object Int32Array]",F="[object Uint8Array]",nt="[object Uint8ClampedArray]",ce="[object Uint16Array]",ue="[object Uint32Array]",Ae=/[\\^$.*+?()[\]{}|]/g,Me=/\w*$/,Oe=/^\[object .+?Constructor\]$/,De=/^(?:0|[1-9]\d*)$/,z={};z[a]=z[u]=z[M]=z[v]=z[c]=z[d]=z[A]=z[U]=z[P]=z[K]=z[D]=z[m]=z[I]=z[k]=z[S]=z[f]=z[_]=z[E]=z[F]=z[nt]=z[ce]=z[ue]=!0,z[p]=z[h]=z[T]=!1;var Re=typeof ht=="object"&&ht&&ht.Object===Object&&ht,Ce=typeof self=="object"&&self&&self.Object===Object&&self,at=Re||Ce||Function("return this")(),le=r&&!r.nodeType&&r,N=le&&!0&&t&&!t.nodeType&&t,de=N&&N.exports===le;function Pe(i,o){return i.set(o[0],o[1]),i}function ot(i,o){return i.add(o),i}function fe(i,o){for(var l=-1,y=i?i.length:0;++l<y&&o(i[l],l,i)!==!1;);return i}function pe(i,o){for(var l=-1,y=o.length,R=i.length;++l<y;)i[R+l]=o[l];return i}function Ht(i,o,l,y){for(var R=-1,O=i?i.length:0;++R<O;)l=o(l,i[R],R,i);return l}function Ut(i,o){for(var l=-1,y=Array(i);++l<i;)y[l]=o(l);return y}function he(i,o){return i==null?void 0:i[o]}function jt(i){var o=!1;if(i!=null&&typeof i.toString!="function")try{o=!!(i+"")}catch{}return o}function me(i){var o=-1,l=Array(i.size);return i.forEach(function(y,R){l[++o]=[R,y]}),l}function Bt(i,o){return function(l){return i(o(l))}}function ge(i){var o=-1,l=Array(i.size);return i.forEach(function(y){l[++o]=y}),l}var xe=Array.prototype,Le=Function.prototype,Mt=Object.prototype,Yt=at["__core-js_shared__"],ye=function(){var i=/[^.]+$/.exec(Yt&&Yt.keys&&Yt.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}(),Ie=Le.toString,pt=Mt.hasOwnProperty,Ot=Mt.toString,ze=RegExp("^"+Ie.call(pt).replace(Ae,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),kt=de?at.Buffer:void 0,Dt=at.Symbol,Wt=at.Uint8Array,st=Bt(Object.getPrototypeOf,Object),be=Object.create,ke=Mt.propertyIsEnumerable,Ne=xe.splice,Gt=Object.getOwnPropertySymbols,Rt=kt?kt.isBuffer:void 0,_e=Bt(Object.keys,Object),Ct=yt(at,"DataView"),_t=yt(at,"Map"),ct=yt(at,"Promise"),Pt=yt(at,"Set"),Xt=yt(at,"WeakMap"),vt=yt(Object,"create"),Kt=it(Ct),St=it(_t),Vt=it(ct),qt=it(Pt),tr=it(Xt),Jt=Dt?Dt.prototype:void 0,Ir=Jt?Jt.valueOf:void 0;function xt(i){var o=-1,l=i?i.length:0;for(this.clear();++o<l;){var y=i[o];this.set(y[0],y[1])}}function on(){this.__data__=vt?vt(null):{}}function cn(i){return this.has(i)&&delete this.__data__[i]}function un(i){var o=this.__data__;if(vt){var l=o[i];return l===n?void 0:l}return pt.call(o,i)?o[i]:void 0}function br(i){var o=this.__data__;return vt?o[i]!==void 0:pt.call(o,i)}function er(i,o){var l=this.__data__;return l[i]=vt&&o===void 0?n:o,this}xt.prototype.clear=on,xt.prototype.delete=cn,xt.prototype.get=un,xt.prototype.has=br,xt.prototype.set=er;function Z(i){var o=-1,l=i?i.length:0;for(this.clear();++o<l;){var y=i[o];this.set(y[0],y[1])}}function ln(){this.__data__=[]}function dn(i){var o=this.__data__,l=$e(o,i);if(l<0)return!1;var y=o.length-1;return l==y?o.pop():Ne.call(o,l,1),!0}function fn(i){var o=this.__data__,l=$e(o,i);return l<0?void 0:o[l][1]}function pn(i){return $e(this.__data__,i)>-1}function hn(i,o){var l=this.__data__,y=$e(l,i);return y<0?l.push([i,o]):l[y][1]=o,this}Z.prototype.clear=ln,Z.prototype.delete=dn,Z.prototype.get=fn,Z.prototype.has=pn,Z.prototype.set=hn;function tt(i){var o=-1,l=i?i.length:0;for(this.clear();++o<l;){var y=i[o];this.set(y[0],y[1])}}function mn(){this.__data__={hash:new xt,map:new(_t||Z),string:new xt}}function gn(i){return Se(this,i).delete(i)}function yn(i){return Se(this,i).get(i)}function In(i){return Se(this,i).has(i)}function bn(i,o){return Se(this,i).set(i,o),this}tt.prototype.clear=mn,tt.prototype.delete=gn,tt.prototype.get=yn,tt.prototype.has=In,tt.prototype.set=bn;function ut(i){this.__data__=new Z(i)}function kn(){this.__data__=new Z}function _n(i){return this.__data__.delete(i)}function vn(i){return this.__data__.get(i)}function Sn(i){return this.__data__.has(i)}function Tn(i,o){var l=this.__data__;if(l instanceof Z){var y=l.__data__;if(!_t||y.length<e-1)return y.push([i,o]),this;l=this.__data__=new tt(y)}return l.set(i,o),this}ut.prototype.clear=kn,ut.prototype.delete=_n,ut.prototype.get=vn,ut.prototype.has=Sn,ut.prototype.set=Tn;function Fe(i,o){var l=ir(i)||Ue(i)?Ut(i.length,String):[],y=l.length,R=!!y;for(var O in i)pt.call(i,O)&&!(R&&(O=="length"||Fn(O,y)))&&l.push(O);return l}function kr(i,o,l){var y=i[o];(!(pt.call(i,o)&&Er(y,l))||l===void 0&&!(o in i))&&(i[o]=l)}function $e(i,o){for(var l=i.length;l--;)if(Er(i[l][0],o))return l;return-1}function Tt(i,o){return i&&sr(o,or(o),i)}function rr(i,o,l,y,R,O,L){var x;if(y&&(x=O?y(i,R,O,L):y(i)),x!==void 0)return x;if(!wt(i))return i;var W=ir(i);if(W){if(x=zn(i),!o)return Pn(i,x)}else{var $=zt(i),et=$==h||$==g;if(wr(i))return He(i,o);if($==k||$==a||et&&!O){if(jt(i))return O?i:{};if(x=Et(et?{}:i),!o)return xn(i,Tt(x,i))}else{if(!z[$])return O?i:{};x=Nn(i,$,rr,o)}}L||(L=new ut);var lt=L.get(i);if(lt)return lt;if(L.set(i,x),!W)var X=l?Ln(i):or(i);return fe(X||i,function(rt,Q){X&&(Q=rt,rt=i[Q]),kr(x,Q,rr(rt,o,l,y,Q,i,L))}),x}function En(i){return wt(i)?be(i):{}}function wn(i,o,l){var y=o(i);return ir(i)?y:pe(y,l(i))}function An(i){return Ot.call(i)}function Mn(i){if(!wt(i)||Hn(i))return!1;var o=ar(i)||jt(i)?ze:Oe;return o.test(it(i))}function On(i){if(!Sr(i))return _e(i);var o=[];for(var l in Object(i))pt.call(i,l)&&l!="constructor"&&o.push(l);return o}function He(i,o){if(o)return i.slice();var l=new i.constructor(i.length);return i.copy(l),l}function nr(i){var o=new i.constructor(i.byteLength);return new Wt(o).set(new Wt(i)),o}function ve(i,o){var l=o?nr(i.buffer):i.buffer;return new i.constructor(l,i.byteOffset,i.byteLength)}function _r(i,o,l){var y=o?l(me(i),!0):me(i);return Ht(y,Pe,new i.constructor)}function vr(i){var o=new i.constructor(i.source,Me.exec(i));return o.lastIndex=i.lastIndex,o}function Dn(i,o,l){var y=o?l(ge(i),!0):ge(i);return Ht(y,ot,new i.constructor)}function Rn(i){return Ir?Object(Ir.call(i)):{}}function Cn(i,o){var l=o?nr(i.buffer):i.buffer;return new i.constructor(l,i.byteOffset,i.length)}function Pn(i,o){var l=-1,y=i.length;for(o||(o=Array(y));++l<y;)o[l]=i[l];return o}function sr(i,o,l,y){l||(l={});for(var R=-1,O=o.length;++R<O;){var L=o[R],x=void 0;kr(l,L,x===void 0?i[L]:x)}return l}function xn(i,o){return sr(i,Lt(i),o)}function Ln(i){return wn(i,or,Lt)}function Se(i,o){var l=i.__data__;return $n(o)?l[typeof o=="string"?"string":"hash"]:l.map}function yt(i,o){var l=he(i,o);return Mn(l)?l:void 0}var Lt=Gt?Bt(Gt,Object):jn,zt=An;(Ct&&zt(new Ct(new ArrayBuffer(1)))!=v||_t&&zt(new _t)!=m||ct&&zt(ct.resolve())!=b||Pt&&zt(new Pt)!=f||Xt&&zt(new Xt)!=T)&&(zt=function(i){var o=Ot.call(i),l=o==k?i.constructor:void 0,y=l?it(l):void 0;if(y)switch(y){case Kt:return v;case St:return m;case Vt:return b;case qt:return f;case tr:return T}return o});function zn(i){var o=i.length,l=i.constructor(o);return o&&typeof i[0]=="string"&&pt.call(i,"index")&&(l.index=i.index,l.input=i.input),l}function Et(i){return typeof i.constructor=="function"&&!Sr(i)?En(st(i)):{}}function Nn(i,o,l,y){var R=i.constructor;switch(o){case M:return nr(i);case c:case d:return new R(+i);case v:return ve(i,y);case A:case U:case P:case K:case D:case F:case nt:case ce:case ue:return Cn(i,y);case m:return _r(i,y,l);case I:case _:return new R(i);case S:return vr(i);case f:return Dn(i,y,l);case E:return Rn(i)}}function Fn(i,o){return o=o??s,!!o&&(typeof i=="number"||De.test(i))&&i>-1&&i%1==0&&i<o}function $n(i){var o=typeof i;return o=="string"||o=="number"||o=="symbol"||o=="boolean"?i!=="__proto__":i===null}function Hn(i){return!!ye&&ye in i}function Sr(i){var o=i&&i.constructor,l=typeof o=="function"&&o.prototype||Mt;return i===l}function it(i){if(i!=null){try{return Ie.call(i)}catch{}try{return i+""}catch{}}return""}function Tr(i){return rr(i,!0,!0)}function Er(i,o){return i===o||i!==i&&o!==o}function Ue(i){return Un(i)&&pt.call(i,"callee")&&(!ke.call(i,"callee")||Ot.call(i)==a)}var ir=Array.isArray;function je(i){return i!=null&&Ar(i.length)&&!ar(i)}function Un(i){return Mr(i)&&je(i)}var wr=Rt||Bn;function ar(i){var o=wt(i)?Ot.call(i):"";return o==h||o==g}function Ar(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=s}function wt(i){var o=typeof i;return!!i&&(o=="object"||o=="function")}function Mr(i){return!!i&&typeof i=="object"}function or(i){return je(i)?Fe(i):On(i)}function jn(){return[]}function Bn(){return!1}t.exports=Tr}(pr,pr.exports);var la=pr.exports;const C=Nr(la);function da(t,r){return t.filter(n=>{if(r.forEach(s=>{n.items.includes(s)&&(n.items=n.items.filter(a=>a!==s))}),n.items.length!==0||n.static)return n})}const Y=t=>Object.keys(t).reduce((r,e)=>{const{display:n}=t[e];return Math.max(r,n.to)},0);function q(t,r,e){t.forEach(n=>{const s=n.items.map(k=>String(k)),a=Object.values(r).filter(k=>s.includes(String(k.id))),c=a.filter(k=>!e.includes(String(k.id))).sort((k,b)=>k.display.from-b.display.from),d=a.sort((k,b)=>k.display.from-b.display.from),p=c[c.length-1];let h=(p==null?void 0:p.display.to)||0;d.forEach(k=>{if(e.includes(String(k.id))){const b=k.playbackRate||1;let S;(k.type==="video"||k.type==="audio")&&k.trim?S=(k.trim.to-k.trim.from)/b:S=k.display.to-k.display.from,k.display={from:h,to:h+S},h=h+S}});const m=a.sort((k,b)=>k.display.from-b.display.from).map(k=>String(k.id));let I=0;m.forEach(k=>{const b=[];let S=0;if(b.forEach(f=>{f.forEach(_=>{_.type==="transition"&&(S+=_.duration)})}),r[String(k)]){const f=r[String(k)],_=f.playbackRate||1;let E;(f.type==="video"||f.type==="audio")&&f.trim?E=(f.trim.to-f.trim.from)/_:E=f.display.to-f.display.from,r[String(k)].display={from:I-S,to:I+E-S},I+=E}})})}function Hs(t,r,e,n,s,a){return r.forEach(u=>{if(!t.includes(u)&&(s[u]=e[u],e[u].type==="composition"||e[u].type==="template")){const c=n.find(d=>d.id===u);c&&(a.push(c),Hs(t,c.items,e,n,s,a))}}),{updatedTrackItems:s,updatedStructure:a}}function fa(t,r){const e=C(t),n=r&&r.length?r:e.activeIds,s=n.map(v=>e.trackItemsMap[v]).filter(v=>!!v).map(v=>v.id),a=e.transitionIds.filter(v=>{const A=e.transitionsMap[v];return s.includes(A.fromId)||s.includes(A.toId)});s.push(...a);const u=e.trackItemIds,c=e.transitionIds,d=C(e.tracks),p=C(e.structure);s.forEach(v=>{var U;const A=e.trackItemsMap[v]||e.transitionsMap[v];if(A.type==="template"||A.type==="composition"){const P=(U=e.structure.find(D=>D.id===A.id))==null?void 0:U.items;s.push(...P);const K=p.findIndex(D=>D.id===A.id);p.splice(K,1)}}),s.forEach(v=>{p.forEach(A=>{A.items.includes(v)&&(A.items=A.items.filter(U=>U!==v))})});const h=u.filter(v=>!s.includes(v));c.forEach(v=>{n.includes(v)&&n.length===1&&C(e.transitionsMap[v])});const g=c.filter(v=>!s.includes(v)&&!n.includes(v)),m=Object.fromEntries(Object.entries(e.transitionsMap).filter(([v])=>!s.includes(v)));Object.keys(m).forEach(v=>{n.includes(v)&&(m[v].kind="none")});const I=e.trackItemIds.filter(v=>!n.includes(v)),k=da(e.tracks,n),b=Object.fromEntries(Object.entries(e.trackItemsMap).filter(([v])=>!s.includes(v))),S=d.filter(v=>v.magnetic);q(S,b,[]);const f={},_=[],{updatedTrackItems:E,updatedStructure:T}=Hs(s,I,e.trackItemsMap,e.structure,f,_),M=Y(E);return{trackItemIds:h,activeIds:[],trackItemsMap:E,tracks:k,duration:M,structure:T,transitionIds:g,transitionsMap:m}}const pa="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Hr=(t=21)=>{let r="",e=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)r+=pa[e[t]&63];return r};function ee(t=16){const r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",e=r.charAt(Math.floor(Math.random()*r.length));let n=Hr(t-1);return n=n.replace(/[^a-zA-Z0-9]/g,"").slice(0,t-1),e+n}const Ee=t=>{const r=t.map(e=>new FontFace(e.fontFamily,`url(${e.url})`).load().catch(n=>n));return r.length===0?Promise.resolve(!0):new Promise((e,n)=>{Promise.all(r).then(s=>{s.forEach(a=>{a&&a.family&&(document.fonts.add(a),e(!0))})}).catch(s=>n(s))})};function ha(t,r){return t.forEach(e=>{r=r.split(e).join(ee())}),r}function Us(t,r,e){const n=t.find(a=>a.id===r);if(!n)return[];const s=n.items;return s.forEach(a=>{const u=e[a];(u.type==="text"||u.type==="caption")&&Ee([{fontFamily:u.details.fontFamily,url:u.details.fontUrl}]),(u.type==="composition"||u.type==="template")&&s.push(...Us(t,a,e))}),s}async function ma(t){let r=localStorage.getItem("DesignComboTemp");if(!r)return{};const e=C(t);let n=C(JSON.parse(r));const s=n.activeIds,a=n.trackItemsMap,u=n.structure;Object.keys(a).forEach(b=>{const S=a[b];if((S.type==="text"||S.type==="caption")&&Ee([{fontFamily:S.details.fontFamily,url:S.details.fontUrl}]),S.type==="composition"||S.type==="template"){const f=Us(u,b,a);s.push(...f)}});const c=ha(s,r),d=C(JSON.parse(c)),p=e.tracks;d.activeIds.forEach(b=>{const S=d.trackItemsMap[b];e.trackItemsMap[b]=S,e.trackItemIds.push(b);const f={id:ee(),type:S.type,items:[b],magnetic:!1,static:!1,muted:!1};p.unshift(f)});const h=[...d.structure,...e.structure],g=e.trackItemIds,m={...d.trackItemsMap,...e.trackItemsMap},I={structure:h,trackItemIds:g,trackItemsMap:m,tracks:p},k=Y(I.trackItemsMap);return{trackItemIds:I.trackItemIds,trackItemsMap:I.trackItemsMap,structure:I.structure,tracks:I.tracks,duration:k}}let hr={cors:{audio:!0,video:!0,image:!0},acceptsMap:{text:["text","caption","composition"],image:["image","video"],video:["video","image"],audio:["audio"],composition:["composition"],caption:["caption","text","composition"],template:["template","image","video"],customTrack:["video","image","template"],customTrack2:["video","image","template"],illustration:["illustration","custom"],custom:["custom","video","illustration"],main:["video","image","template"],shape:["shape","custom","illustration"],linealAudioBars:["audio","linealAudioBars"],radialAudioBars:["audio","radialAudioBars"],progressFrame:["audio","progressFrame"],progressBar:["audio","progressBar"],rect:["rect"],progressSquare:["progressSquare"]}};const ga=t=>{const r=Object.fromEntries(Object.entries(t).filter(([e,n])=>n!==void 0));hr={...hr,...r}},Ur=()=>hr.cors,jr=()=>hr.acceptsMap,we=t=>new Promise((r,e)=>{const n=new Image;n.onload=()=>{const a=n.width,u=n.height;r({width:a,height:u})},n.onerror=a=>{e(a)},Ur().image&&(n.crossOrigin="anonymous"),n.src=t}),js=t=>new Promise((r,e)=>{const n=new Audio;n.preload="auto",n.addEventListener("loadedmetadata",()=>{const a=n.duration*1e3;r({duration:a})}),n.addEventListener("error",a=>{e(a)}),n.src=t,Ur().audio&&(n.crossOrigin="anonymous"),n.load()}),Br=t=>new Promise((r,e)=>{const n=document.createElement("video");n.preload="auto",n.addEventListener("loadedmetadata",()=>{const a=n.duration*1e3,u=n.videoWidth,c=n.videoHeight;r({duration:a,width:u,height:c})}),n.addEventListener("error",a=>{e(a)}),n.src=t,Ur().video&&(n.crossOrigin="anonymous"),n.load()}),ya=async t=>{var s,a;const r=t.duration,e=(s=t.details)==null?void 0:s.width,n=(a=t.details)==null?void 0:a.height;return r&&e&&n?{duration:r,width:e,height:n}:Br(t.details.src)},Bs=(t,r)=>{const e=document.createElement("div");Object.keys(r).forEach(s=>{s!=="height"&&(e.style[s]=r[s])}),document.body.appendChild(e),e.textContent=t,e.style.whiteSpace="normal",e.style.position="absolute",e.style.visibility="hidden",e.style.display="inline-block",e.style.width=r.width+"px",e.style.fontSize=r.fontSize+"px";const n=getComputedStyle(e).height;return document.body.removeChild(e),parseFloat(n)},Ys=(t,r)=>{var c,d;const e=((c=t.details.crop)==null?void 0:c.width)||t.details.width||0,n=((d=t.details.crop)==null?void 0:d.height)||t.details.height||0;let s=r.width,a=r.height;const u=r.width/r.height;return e/n>u?(s=e,a=e/u):(a=n,s=n*u),{newWidth:s,newHeight:a,crop:{x:0,y:0,height:n,width:e}}},Ws=(t,r)=>{const e=C(t.trim),n=C(t.display);return r.duration<t.display.to&&(n.to=r.duration+t.display.from,e&&(e.to=r.duration)),{duration:r.duration,trim:e,display:n}};async function Ia(t,r){const e={...t},n=Object.keys(r)[0],s=Object.values(r)[0],a=e.trackItemsMap[n],u={...e.trackItemsMap[n]},c=a.details;if(!s.details.src)return{};if(a.type==="image"){const d=await we(s.details.src),{crop:p,newHeight:h,newWidth:g}=Ys(a,d);s.details.crop=p,s.details.height=h,s.details.width=g}else if(a.type==="video"){const d=await Br(s.details.src),p=e.trackItemsMap[n],{display:h,duration:g,trim:m}=Ws(p,d),{crop:I,newHeight:k,newWidth:b}=Ys(a,d);s.details.crop=I,s.details.height=k,s.details.width=b,u.display=h,u.duration=g,u.trim=m}else if(a.type==="audio"){const d=await js(s.details.src),p=e.trackItemsMap[n],{display:h,duration:g,trim:m}=Ws(p,d);u.display=h,u.duration=g,u.trim=m}return a.metadata&&s.metadata?u.metadata={...a.metadata,...s.metadata}:s.metadata&&(u.metadata=s.metadata),a.details={...c,...s.details},e.trackItemsMap[n]={...u},{trackItemsMap:{...e.trackItemsMap,[n]:{...u,details:{...c,...s.details}}}}}function ba(t,r){const e=C(t),n={},s=r&&r.length?r:e.activeIds;if(s.length===0)return{};s.forEach(u=>{const c=e.trackItemsMap[u],d=ee();e.trackItemsMap[d]={...C(c),id:d},e.trackItemIds.push(d);const p=e.tracks.find(h=>h.items.includes(u));n[p.id]?n[p.id].items.push(d):n[p.id]={...p,id:ee(),items:[d],static:!1,magnetic:!1}});const a=Object.values(n);return e.tracks=[...a,...e.tracks],{trackItemsMap:e.trackItemsMap,tracks:e.tracks,trackItemIds:e.trackItemIds}}function ka(t){const r=/#([0-9a-fA-F]{3,6})\b/g,e=/rgb\(\s*(\d+),\s*(\d+),\s*(\d+)\s*\)/g,n=/rgba\(\s*(\d+),\s*(\d+),\s*(\d+),\s*([0-9.]+)\s*\)/g;function s(u){return u.length===3?`#${u[0]}${u[0]}${u[1]}${u[1]}${u[2]}${u[2]}`.toUpperCase():`#${u.toUpperCase()}`}function a(u,c,d){return`#${(1<<24|u<<16|c<<8|d).toString(16).slice(1).toUpperCase()}`}return t=t.replace(r,(u,c)=>s(c)),t=t.replace(e,(u,c,d,p)=>a(+c,+d,+p)),t=t.replace(n,(u,c,d,p)=>a(+c,+d,+p)),t}function J(t){return/^#[0-9a-fA-F]{3}$/.test(t)?"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]:t}function Gs(t,r){let e=t;for(const n in r)if(Object.prototype.hasOwnProperty.call(r,n)){const s=new RegExp(n,"g");e=e.replace(s,r[n])}return e}function Xs(t){const r=t.getAttribute("fill");if(r&&r.trim()!==""&&r.trim()!=="none")return r.trim();const e=t.getAttribute("style");if(e){const s=/fill\s*:\s*([^;]+);?/.exec(e);if(s){const a=s[1].trim();if(a!==""&&a!=="none")return a}}const n=t.parentElement;return n?Xs(n):null}function We(t){return/^#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})$/.test(t)}const _a=t=>{const r=`.${t.split(".").filter(a=>a.includes("fill:")).join(".")}`,e={},n=/\.([\w-]+)\s*\{\s*([^}]+)\s*\}/g;let s;for(;(s=n.exec(r))!==null;){const a=s[1],u=s[2],c={},d=/fill\s*:\s*([^;]+);?/.exec(u),p=/stroke\s*:\s*([^;]+);?/.exec(u);d&&(c.fill=J(d[1].trim())),p&&(c.stroke=J(p[1].trim())),e[a]=c}return e};function Yr(t){let r=t.parentElement;for(;r;){if(r.tagName.toLowerCase()==="mask")return!0;r=r.parentElement}return!1}function va(t,r,e=300,n=300){const s=[],u=new DOMParser().parseFromString(t,"image/svg+xml"),c=u.documentElement;c.setAttribute("width",`${e}`),c.setAttribute("height",`${n}`);const d=c.querySelectorAll("style"),p={};d.forEach(b=>{const S=b.textContent||"",f=_a(S);Object.assign(p,f);const _=S.replace(/\.(st[\w-]+)/g,`.${r}-$1`).replace(/url\(#(.*?)\)/g,`url(#${r}-$1)`);b.textContent=_;const E=Array.from(u.querySelectorAll("*")),T=new Set;E.forEach(M=>{if(Yr(M))return;["fill","stroke","stop-color"].forEach(U=>{const P=M.getAttribute(U);P&&!["none","transparent"].includes(P)&&T.add(J(P))});const v=M.getAttribute("style");if(v){const U=/fill\s*:\s*([^;]+);?/.exec(v),P=/stroke\s*:\s*([^;]+);?/.exec(v),K=/stop-color\s*:\s*([^;]+);?/.exec(v);if(U){const D=U[1].trim();D&&!["none","transparent"].includes(D)&&We(J(D))&&T.add(J(D))}if(P){const D=P[1].trim();D&&!["none","transparent"].includes(D)&&We(J(D))&&T.add(J(D))}if(K){const D=K[1].trim();D&&!["none","transparent"].includes(D)&&We(J(D))&&T.add(J(D))}}const A=M.getAttribute("class");A&&A.split(" ").forEach(U=>{const P=p[U];P!=null&&P.fill&&!["none","transparent"].includes(P.fill)&&T.add(J(P.fill)),P!=null&&P.stroke&&!["none","transparent"].includes(P.stroke)&&T.add(J(P.stroke))})}),Array.from(T).forEach(M=>{We(M)&&s.push(M)})});const h=Array.from(u.querySelectorAll("*")),g=new Set;return h.forEach(b=>{if(Yr(b))return;const S=b.getAttribute("class");if(S){const _=S.split(" ").map(E=>`${r}-${E}`).join(" ");b.setAttribute("class",_),_.split(" ").forEach(E=>{const T=p[E];T!=null&&T.fill&&!["none","transparent"].includes(T.fill)&&g.add(J(T.fill)),T!=null&&T.stroke&&!["none","transparent"].includes(T.stroke)&&g.add(J(T.stroke))})}["fill","stroke","stop-color"].forEach(_=>{const E=b.getAttribute(_);E&&!["none","transparent"].includes(E)&&g.add(J(E))});const f=b.getAttribute("style");if(f){const _=/fill\s*:\s*([^;]+);?/.exec(f),E=/stroke\s*:\s*([^;]+);?/.exec(f),T=/stop-color\s*:\s*([^;]+);?/.exec(f);if(_){const M=_[1].trim();M&&!["none","transparent"].includes(M)&&g.add(J(M))}if(E){const M=E[1].trim();M&&!["none","transparent"].includes(M)&&g.add(J(M))}if(T){const M=T[1].trim();M&&!["none","transparent"].includes(M)&&g.add(J(M))}}}),g.forEach(b=>!s.includes(b)&&We(b)&&s.push(b)),Array.from(u.querySelectorAll("*")).forEach(b=>{if(b.hasAttribute("id")){const S=b.getAttribute("id");b.setAttribute("id",`${r}-${S}`)}if(["fill","stroke","stop-color","filter","clip-path","mask"].forEach(S=>{const f=b.getAttribute(S);f&&f.includes("url(#")&&b.setAttribute(S,f.replace(/url\(#(.*?)\)/g,`url(#${r}-$1)`))}),b.hasAttribute("style")){const S=b.getAttribute("style");S.includes("url(#")&&b.setAttribute("style",S.replace(/url\(#(.*?)\)/g,`url(#${r}-$1)`))}}),Array.from(u.querySelectorAll("path")).forEach(b=>{if(Yr(b))return;!Xs(b)&&!b.getAttribute("class")&&(b.setAttribute("fill","#000000"),s.includes("#000000")||s.push("#000000"))}),{serializer:new XMLSerializer().serializeToString(u),colors:s}}const Ge={color:"#000000",x:0,y:0,blur:0},mt=(t,r)=>{let e=r!=null&&r.trim?r.trim.to-r.trim.from:(r==null?void 0:r.duration)||5e3;const n={from:0,to:e};if(!t)return n;if(t.from<0)return console.error("'from' must be a non-negative number. Returning default display."),n;if(t.from!==void 0&&t.to===void 0)return{from:t.from,to:t.from+e};if(t.to!==void 0){if(t.to<0)return console.error("'to' must be a non-negative number. Returning default display."),n;if(t.to<t.from)return console.error("'to' must be greater than or equal to 'from'. Returning default display."),n}return t},Ks=(t,r)=>t?t.from&&!t.to?{from:t.from,to:r.duration}:t:{from:0,to:r.duration};function Vs(t,r){const e={x:t.size.width/2,y:t.size.height/2},n={x:r.width/2,y:r.height/2},s=e.x-n.x;return{top:`${e.y-n.y}px`,left:`${s}px`,transform:"none"}}function gt(t,r){const e=t.scaleMode,n={x:t.size.width/2,y:t.size.height/2},s={x:r.width/2,y:r.height/2};let a;if(e==="fill")a=Math.max(t.size.width/r.width,t.size.height/r.height);else if(e==="fit"){const d=t.scaleAspectRatio||1;a=Math.min(t.size.width/r.width,t.size.height/r.height)*d}else a=Math.min(t.size.width/r.width,t.size.height/r.height);const u=n.x-s.x;return{top:`${n.y-s.y}px`,left:`${u}px`,transform:`scale(${a})`}}const qs=async(t,r)=>{const e=t.details.src,n=await ya(t),s=gt(r,{...n}),a=Ks(t.trim,{duration:n.duration}),u={width:n.width,height:n.height,opacity:100,src:e,volume:t.details.volume??100,borderRadius:t.details.borderRadius??0,borderWidth:t.details.borderWidth??0,borderColor:t.details.borderColor||"#000000",boxShadow:t.details.boxShadow||Ge,top:t.details.top||s.top||"0px",left:t.details.left||s.left||"0px",transform:t.details.transform||s.transform,blur:t.details.blur||0,brightness:t.details.brightness||100,flipX:t.details.flipX||!1,flipY:t.details.flipY||!1,rotate:t.details.rotate||"0deg",visibility:t.details.visibility||"visible"};return{...t,trim:a,type:"video",name:"video",details:u,playbackRate:t.playbackRate||1,display:mt(t.display,{duration:n.duration,trim:a}),duration:n.duration}},Js=async t=>{const r=t.id,e=t.details,s=(await js(e.src)).duration,a=Ks(t.trim,{duration:s});return{id:r,name:t.name||"audio",type:"audio",display:mt(t.display,{duration:s,trim:a}),trim:a,playbackRate:t.playbackRate||1,details:{src:e.src,volume:e.volume??100},metadata:{...t.metadata},duration:s}},Sa=async(t,r)=>{var c,d;const e=t.id,n={width:((c=t.details)==null?void 0:c.width)||r.size.width,height:((d=t.details)==null?void 0:d.height)||r.size.height},s=t.details,a=gt(r,n),u=mt(t.display);return{id:e,name:t.type,type:t.type,display:u,details:{width:(s==null?void 0:s.width)||n.width,height:(s==null?void 0:s.height)||n.height,top:(s==null?void 0:s.top)||a.top,left:(s==null?void 0:s.left)||a.left,border:s.border||"none",borderRadius:s.borderRadius||0,borderWidth:s.borderWidth||0,borderColor:s.borderColor||"#000000",opacity:s.opacity||100,flipX:s.flipX||!1,flipY:s.flipY||!1,inverted:s.inverted||!1,backgroundColors:(s==null?void 0:s.backgroundColors)||["rgba(128, 128, 128,0.5)","rgba(128, 128, 128,1)"]},metadata:{}}},Ta=async(t,r)=>{var c,d;const e=t.id,n={width:((c=t.details)==null?void 0:c.width)||r.size.width,height:((d=t.details)==null?void 0:d.height)||r.size.height},s=t.details,a=gt(r,n),u=mt(t.display);return{id:e,name:t.type,type:t.type,display:u,details:{width:(s==null?void 0:s.width)||n.width,height:(s==null?void 0:s.height)||n.height,top:(s==null?void 0:s.top)||a.top,left:(s==null?void 0:s.left)||a.left,border:s.border||"none",borderRadius:s.borderRadius||0,borderWidth:s.borderWidth||0,borderColor:s.borderColor||"#000000",opacity:s.opacity||100,flipX:s.flipX||!1,flipY:s.flipY||!1,inverted:s.inverted||!1,backgroundColors:(s==null?void 0:s.backgroundColors)||["rgba(128, 128, 128,0.5)","rgba(128, 128, 128,1)"],barThickness:s.barThickness||10},metadata:{}}},Ea=async(t,r)=>{var c,d;const e=t.id,n={width:((c=t.details)==null?void 0:c.width)||r.size.width,height:((d=t.details)==null?void 0:d.height)||r.size.height},s=t.details,a=gt(r,n),u=mt(t.display);return{id:e,name:t.type,type:t.type,display:u,details:{width:(s==null?void 0:s.width)||n.width,height:(s==null?void 0:s.height)||n.height,top:(s==null?void 0:s.top)||a.top,left:(s==null?void 0:s.left)||a.left,radialBarColor:s.radialBarColor||"rgba(128, 128, 128,1)",border:s.border||"none",borderRadius:s.borderRadius||0,borderWidth:s.borderWidth||0,borderColor:s.borderColor||"#000000",opacity:s.opacity||100,flipX:s.flipX||!1,flipY:s.flipY||!1},metadata:{}}},wa=async(t,r)=>{var c,d;const e=t.id,n={width:((c=t.details)==null?void 0:c.width)||r.size.width,height:((d=t.details)==null?void 0:d.height)||r.size.height},s=t.details,a=gt(r,n),u=mt(t.display);return{id:e,name:t.type,type:t.type,display:u,details:{width:(s==null?void 0:s.width)||n.width,height:(s==null?void 0:s.height)||n.height,top:(s==null?void 0:s.top)||a.top,left:(s==null?void 0:s.left)||a.left,border:s.border||"none",borderRadius:s.borderRadius||0,borderWidth:s.borderWidth||0,borderColor:s.borderColor||"#000000",opacity:s.opacity||100,strokeColors:(s==null?void 0:s.strokeColors)||["#ff9800","#ff5722"],strokeWidth:(s==null?void 0:s.strokeWidth)||100,strokeBackground:(s==null?void 0:s.strokeBackground)||"#fff",flipX:(s==null?void 0:s.flipX)||!1,flipY:(s==null?void 0:s.flipY)||!1,rotate:(s==null?void 0:s.rotate)||"0deg",transform:(s==null?void 0:s.transform)||"none"},metadata:{}}},Wr=async(t,r)=>{var u,c;const e=t.id,n={width:((u=t.details)==null?void 0:u.width)||r.size.width,height:((c=t.details)==null?void 0:c.height)||r.size.height},s=t.details,a=gt(r,n);return{id:e,name:t.type,type:t.type,display:{from:0,to:t.duration||1e4},details:{width:(s==null?void 0:s.width)||n.width,height:(s==null?void 0:s.height)||n.height,top:(s==null?void 0:s.top)||a.top,left:(s==null?void 0:s.left)||a.left,border:s.border||"none",borderRadius:s.borderRadius||0,borderWidth:s.borderWidth||0,borderColor:s.borderColor||"#000000",opacity:s.opacity||100,flipX:s.flipX||!1,flipY:s.flipY||!1,inverted:s.inverted||!1,linealBarColor:s.linealBarColor||"rgba(128, 128, 128,1)",lineThickness:s.lineThickness||1,gapSize:s.gapSize||1,roundness:s.roundness||1,placement:s.placement||null,strokeColor:s.strokeColor||"#92E1B0",fillColor:s.fillColor||null,strokeWidth:s.strokeWidth||null,copies:s.copies||null,offsetPixelSpeed:s.offsetPixelSpeed||0,lineColor:s.lineColor||"#92E1B0",lineGap:s.lineGap||0,topRoundness:s.topRoundness||0,bottomRoundness:s.bottomRoundness||0,lines:s.lines||0,sections:s.sections||0},metadata:{}}},Zs=async(t,r)=>{var g;const e=t.trackItemIds,n=t.size||{width:t.details.width,height:t.details.height},s=Math.min(r.size.width/n.width,r.size.height/n.height),a=((g=t.details)==null?void 0:g.rotate)||0,u=gt(r,n),c=t.display;let d=1/0,p=0;e.forEach(m=>{const I=t.trackItemsMap[m];I.display.from<d&&(d=I.display.from),I.display.to>p&&(p=I.display.to)});const h=t.trim||t.display||{from:d,to:p};return{id:t.id,type:"template",details:{...n,transform:t.details.transform||u.transform,top:t.details.top||u.top,left:t.details.left||u.left,scale:s,rotate:a,background:t.details.background||"transparent"},trim:h,display:c||{from:d,to:p},activeEdit:!1}},Aa=async(t,r)=>{var h;const e=t.trackItemIds,n=t.size||{width:t.details.width,height:t.details.height},s=Math.min(r.size.width/n.width,r.size.height/n.height),a=((h=t.details)==null?void 0:h.rotate)||0,u=gt(r,n),c=t.display;let d=1/0,p=0;return e.forEach(g=>{const m=t.trackItemsMap[g];m.display.from<d&&(d=m.display.from),m.display.to>p&&(p=m.display.to)}),{id:t.id,type:"composition",details:{...n,transform:t.details.transform||u.transform,top:t.details.top||u.top,left:t.details.left||u.left,scale:s,rotate:a},display:c||{from:d,to:p}}},Qs=async(t,r)=>{const e=t.details,n=we(e.src),s=fetch(e.src),[a,u]=await Promise.all([n,s]),c=await u.text(),d=gt(r,a),{serializer:p,colors:h}=va(ka(c),t.id,Number(e.width||a.width),Number(e.height||a.height)),g=t.details.colorMap||Object.fromEntries(h.map(m=>[m,m]));return{id:t.id,name:"illustration",type:t.type,display:mt(t.display),playbackRate:t.playbackRate||1,details:{src:e.src||"",width:e.width||a.width||100,height:e.height||a.height||100,opacity:e.opacity??100,transform:e.transform||d.transform,border:e.border||"none",borderRadius:e.borderRadius||0,top:e.top||d.top||"0px",left:e.left||d.left||"0px",borderWidth:e.borderWidth??0,borderColor:e.borderColor||"#000000",flipX:e.flipX||!1,flipY:e.flipY||!1,rotate:e.rotate||"0deg",visibility:e.visibility||"visible",svgString:p,initialSvgString:C(p),colorMap:g},metadata:t.metadata||{}}},Ma=async(t,r)=>{const e=t.details,n=we(e.src),[s]=await Promise.all([n]),a=gt(r,s);return{id:t.id,name:"shape",type:t.type,display:mt(t.display),playbackRate:t.playbackRate||1,details:{src:e.src||"",width:e.width||s.width||100,height:e.height||s.height||100,opacity:e.opacity??100,transform:e.transform||a.transform,border:e.border||"none",borderRadius:e.borderRadius||0,top:e.top||a.top||"0px",left:e.left||a.left||"0px",borderWidth:e.borderWidth??0,borderColor:e.borderColor||"#000000",flipX:e.flipX||!1,flipY:e.flipY||!1,rotate:e.rotate||"0deg",visibility:e.visibility||"visible",backgroundColor:e.backgroundColor||"#808080"},metadata:t.metadata||{}}},Oa=async(t,r)=>{const e=t.details,n=gt(r,{width:e.width,height:e.height});return{id:t.id,name:"rect",type:t.type,display:mt(t.display),playbackRate:t.playbackRate||1,details:{width:e.width||100,height:e.height||100,opacity:e.opacity??100,transform:e.transform||n.transform,border:e.border||"none",borderRadius:e.borderRadius||0,top:e.top||n.top||"0px",left:e.left||n.left||"0px",borderWidth:e.borderWidth??0,borderColor:e.borderColor||"#000000",flipX:e.flipX||!1,flipY:e.flipY||!1,rotate:e.rotate||"0deg",visibility:e.visibility||"visible",backgroundColor:e.backgroundColor||"#808080",boxShadow:e.boxShadow||Ge,blur:e.blur||0,brightness:e.brightness||100},metadata:t.metadata||{}}},ti=async(t,r)=>{const e=t.details,n=await we(e.src),s=gt(r,n);return{id:t.id,type:"image",name:"image",display:mt(t.display),playbackRate:t.playbackRate||1,details:{src:e.src||"",width:e.width||n.width||100,height:e.height||n.height||100,opacity:e.opacity??100,transform:e.transform||s.transform,border:e.border||"none",borderRadius:e.borderRadius||0,boxShadow:e.boxShadow||Ge,top:e.top||s.top||"0px",left:e.left||s.left||"0px",borderWidth:e.borderWidth??0,borderColor:e.borderColor||"#000000",blur:e.blur||0,brightness:e.brightness||100,flipX:e.flipX||!1,flipY:e.flipY||!1,rotate:e.rotate||"0deg",visibility:e.visibility||"visible"},metadata:t.metadata||{}}},ei=async(t,r)=>{const e=t;e.details.fontUrl&&await Ee([{fontFamily:e.details.fontFamily,url:e.details.fontUrl}]);const n=e.id,s=e.details,a=ni(s),u=s.height||Bs(e.details.text,a),c=s.top!=null&&s.left!=null?{top:`${s.top}px`,left:`${s.left}px`}:Vs(r,{width:a.width,height:u});return{id:n,name:"caption",type:"caption",display:mt(e.display),details:{...e.details,...a,text:s.text||"",height:u,fontUrl:s.fontUrl,top:a.top||c.top,left:a.left||c.left,borderWidth:s.borderWidth||0,borderColor:s.borderColor||"#000000",boxShadow:s.boxShadow||Ge,words:s.words||[],appearedColor:s.appearedColor||s.color,activeColor:s.activeColor||s.color,activeFillColor:s.activeFillColor||"transparent",isKeywordColor:s.isKeywordColor||"transparent",preservedColorKeyWord:s.preservedColorKeyWord||!1,linesPerCaption:s.linesPerCaption||2,wordsPerLine:s.wordsPerLine||"punctuationOrPause"},metadata:t.metadata||{}}},ri=async(t,r)=>{t.details.fontUrl&&await Ee([{fontFamily:t.details.fontFamily,url:t.details.fontUrl}]);const e=t.id,n=t.details,s=ni(n),a=n.height||Bs(t.details.text,s),u=n.top!=null&&n.left!=null?{top:`${n.top}px`,left:`${n.left}px`}:Vs(r,{width:s.width,height:a});return{id:e,name:"text",type:"text",display:mt(t.display),details:{...t.details,...s,text:n.text||"",height:a,fontUrl:n.fontUrl,top:s.top||u.top,left:s.left||u.left,borderWidth:n.borderWidth||0,borderColor:n.borderColor||"#000000",boxShadow:n.boxShadow||Ge},metadata:{}}},ni=t=>({fontFamily:t.fontFamily||"Arial",fontSize:t.fontSize||"16px",fontWeight:t.fontWeight||"normal",fontStyle:t.fontStyle||"normal",textDecoration:t.textDecoration||"none",textAlign:t.textAlign||"left",lineHeight:t.lineHeight||"normal",letterSpacing:t.letterSpacing||"normal",wordSpacing:t.wordSpacing||"normal",color:t.color||"#ffffff",backgroundColor:t.backgroundColor||"transparent",border:t.border||"none",textShadow:t.textShadow||"none",text:t.text||"",opacity:t.opacity??100,width:t.width||300,wordWrap:t.wordWrap||"normal",wordBreak:t.wordBreak||"normal",WebkitTextStrokeColor:t.WebkitTextStrokeColor||"#ffffff",WebkitTextStrokeWidth:t.WebkitTextStrokeWidth||"0px",top:t.top,left:t.left,textTransform:t.textTransform||"none",transform:t.transform||"none",skewX:t.skewX||0,skewY:t.skewY||0}),Da=async(t,r)=>{switch(t.type){case"video":return qs(t,r||{});case"audio":return Js(t);case"image":return ti(t,r||{});case"text":return ri(t,r||{});case"caption":return ei(t,r||{});case"template":return Zs(t,{size:r==null?void 0:r.size});default:throw new Error("Unsupported track item")}};function si(t,r){return r.some(e=>t.some(n=>n.id===e.id))}const ii=(t=[],r=[])=>t.length===0?r.map(n=>({id:ee(),items:[n.id],type:n.type,accepts:["text","image","video","audio","caption","template"]})):t.map(e=>({...e,items:e.items||[],accepts:["audio","video","image","text","caption","template"],type:e.type||"text",magnetic:e.magnetic||!1,static:e.static||!1,id:e.id||ee(),muted:e.muted||!1}));async function Ra(t,r){var u,c,d;const e=r.trackItemsMap,n=new Set,s=new Map;for(const p in e){const h=e[p];if(h.type==="text"||h.type==="caption"){if(h.details.fontUrl){const g={fontFamily:h.details.fontFamily,url:h.details.fontUrl};n.add(JSON.stringify(g))}(u=h.animations)!=null&&u.in&&h.animations.in.composition.forEach(g=>{var m;(m=g.details)!=null&&m.fonts&&g.details.fonts.forEach(I=>{n.add(JSON.stringify(I))})}),(c=h.animations)!=null&&c.loop&&h.animations.loop.composition.forEach(g=>{var m;(m=g.details)!=null&&m.fonts&&g.details.fonts.forEach(I=>{n.add(JSON.stringify(I))})}),(d=h.animations)!=null&&d.out&&h.animations.out.composition.forEach(g=>{var m;(m=g.details)!=null&&m.fonts&&g.details.fonts.forEach(I=>{n.add(JSON.stringify(I))})})}else h.type==="illustration"&&s.set(p,{trackItem:h,details:h.details})}n.size>0&&await Ee(Array.from(n).map(p=>JSON.parse(p)));for(const[p,h]of s){const g=await Qs({...h.trackItem,details:h.details},{size:{width:h.details.width,height:h.details.height}}),m=Gs(g.details.svgString,h.details.colorMap);g.details.svgString=m,e[p]=g}const a=Y(e);return{...r,duration:a}}function Ca(t){const r=C(t);if(!r.activeIds.length)return;const e=r.activeIds,n=[],s={activeIds:e,trackItemsMap:{},tracks:[],structure:[]};e.forEach(d=>{s.trackItemsMap[d]=r.trackItemsMap[d],n.push(r.tracks.find(p=>p.items.includes(d)))});const a=new Set;n.filter(d=>a.has(d.id)?!1:(a.add(d.id),!0)),s.tracks=Array.from(a),s.activeIds.forEach(d=>{if(s.trackItemsMap[d].type==="composition"||s.trackItemsMap[d].type==="template"){const p=r.structure.find(h=>h.id===d);p&&(s.structure.push(p),p.items.forEach(h=>{s.trackItemsMap[h]=r.trackItemsMap[h]}))}});let c=JSON.stringify(s);localStorage.setItem("DesignComboTemp",c)}function Pa(t,r){const e=C(t);if(e.activeIds.length!==1)return{};const n=e.activeIds[0],s=C(e.trackItemsMap[n]);if(r>=s.display.to||r<=s.display.from)return{};const a=ee(),u={...s,display:{from:s.display.from,to:r}},c={...s,id:a,display:{from:r,to:s.display.to}},d=Object.values(e.transitionsMap).find(h=>h.fromId===s.id&&h.kind!=="none"),p=Object.values(e.transitionsMap).find(h=>h.toId===s.id&&h.kind!=="none");if(s.type==="video"||s.type==="audio"){const h=r-u.display.from;u.trim={from:s.trim.from,to:s.trim.from+h},c.trim={from:s.trim.from+h,to:s.trim.to}}if(p){const h=u.display.to-u.display.from;if(p.duration/2>h){e.transitionIds=e.transitionIds.filter(m=>m!==p.id);const g={};e.transitionIds.forEach(m=>g[m]=e.transitionsMap[m]),e.transitionsMap=g}}if(d){const h=c.display.to-c.display.from,g={};d.duration/2>h?(e.transitionIds=e.transitionIds.filter(m=>m!==d.id),e.transitionIds.forEach(m=>g[m]=e.transitionsMap[m]),e.transitionsMap=g):(e.transitionIds=e.transitionIds.map(m=>e.transitionsMap[m].fromId===u.id?m.replace(u.id,a):m),Object.keys(e.transitionsMap).forEach(m=>{if(e.transitionsMap[m].fromId===u.id){const k=m.replace(u.id,a);g[k]={...e.transitionsMap[m],id:k,fromId:a}}else g[m]=e.transitionsMap[m]}),e.transitionsMap=g)}return e.trackItemsMap[n]=u,e.trackItemsMap[a]=c,e.trackItemIds.push(a),e.tracks.forEach(h=>{h.items.includes(n)&&h.items.push(a)}),{tracks:e.tracks,trackItemIds:e.trackItemIds,trackItemsMap:e.trackItemsMap,transitionsMap:e.transitionsMap,transitionIds:e.transitionIds}}async function xa(t,r){const e=C(t),n=e.trackItemsMap,s=Object.keys(r);if(!s.length)return{};for(const c of s){const d=r[c];if(d.details&&(n[c].details={...n[c].details,...d.details},d.details.colorMap)){const p=n[c].details.initialSvgString,h=Gs(p,d.details.colorMap);n[c].details.svgString=h}if(d.metadata&&(n[c].metadata?n[c].metadata={...n[c].metadata,...d.metadata}:n[c].metadata=d.metadata),d.display||d.playbackRate){const p=d.playbackRate,h=n[c].playbackRate||1,g=n[c].display,k=(g.to-g.from)*h/p,b={from:g.from,to:g.from+k};n[c].display=b,n[c].playbackRate=p}d.animations&&(n[c].animations={...n[c].animations,...d.animations})}for(const c of s){const d=r[c];if(n[c].type==="shape"&&d.details.src){const p=await we(d.details.src);n[c].details.width=p.width,n[c].details.height=p.height}}if(s.some(c=>{const d=r[c];return d.display!==void 0||d.playbackRate!==void 0})){const c=e.tracks.filter(h=>h.magnetic);s.filter(h=>c.some(g=>g.items.includes(h))).length>0&&q(c,n,[]);const p=[];for(const h of s){const g=r[h];if(g.playbackRate===void 0&&g.display===void 0)continue;const m=n[h];if(!m)continue;const I=e.tracks.find(_=>_.items.includes(h));if(!I||I.magnetic)continue;const k=m.display;if(Object.values(e.transitionsMap).filter(_=>_.fromId===h||_.toId===h).forEach(_=>{const E=n[_.fromId],T=n[_.toId];if(!E||!T){p.push(_.id);return}const M=E.display,v=T.display,A=M.to,U=v.from;Math.abs(A-U)<=1||p.push(_.id)}),I.items.map(_=>n[_]).filter(_=>_&&_.id!==h).some(_=>{const E=_.display.from,T=_.display.to,M=k.from;return!(k.to<=E||M>=T)})){const _=e.tracks.findIndex(M=>M.id===I.id);I.items=I.items.filter(M=>M!==h);const E={id:Hr(),accepts:Object.keys(jr()),type:m.type,items:[h],magnetic:!1,static:!1,muted:!1},T=Math.max(0,_-1);e.tracks.splice(T,0,E)}}p.length>0&&(e.transitionIds=e.transitionIds.filter(h=>!p.includes(h)),p.forEach(h=>{delete e.transitionsMap[h]}))}const u=Y(n);return{trackItemsMap:{...n},tracks:e.tracks,transitionIds:e.transitionIds,transitionsMap:e.transitionsMap,duration:u}}async function La(t,r){const e=C(t),n=Object.keys(r)[0],s=Object.values(r)[0],a=e.trackItemsMap[n],u=a.details;if(!s.details.src)return{};if(a.type==="image"){const p=await we(s.details.src),h=a.details.width||0,g=a.details.height||0;let m=p.width,I=p.height;const k=p.width/p.height;h/g>k?(m=h,I=h/k):(I=g,m=g*k),u.crop={x:0,y:0,height:u.height,width:u.width},s.details.width=m,s.details.height=I}else if(a.type==="video"){const p=await Br(s.details.src),h=a.details.width||0,g=a.details.height||0;let m=p.width,I=p.height;const k=p.width/p.height;h/g>k?(m=h,I=h/k):(I=g,m=g*k),u.crop={x:0,y:0,height:u.height,width:u.width},s.details.width=m,s.details.height=I,a.duration=p.duration,a.trim={from:0,to:p.duration};const b=a.playbackRate||1,S=p.duration/b,f=a.display.from+S;a.display={from:a.display.from,to:(a.duration||0)>=p.duration?a.display.to:f}}s.details&&(a.details={...u,...s.details},s.details=a.details),e.trackItemsMap[n]={...e.trackItemsMap[n],type:s.type},a.type==="video"&&(e.trackItemsMap[n].display=a.display,e.trackItemsMap[n].duration=a.duration,e.trackItemsMap[n].trim=a.trim);const c=e.tracks.find(p=>p.items.includes(n));if(c&&c.magnetic&&a.type==="video"){const p=e.tracks.filter(h=>h.magnetic);q(p,e.trackItemsMap,[])}const d=Y(e.trackItemsMap);return{trackItemsMap:{...e.trackItemsMap},tracks:e.tracks,duration:d}}function za(t,r){const e=C(t);return e.background.value=r.value,e.background.type=r.type||"color",{...e}}function Na(t,{idTrack:r,idItems:e},n){const s=n.tracks.find(c=>c.id===r);if(!s||!s.magnetic)return;let u=s.items.reduce((c,d)=>{const p=n.trackItemsMap[d];return p.display.to>c.display.to?p:c},{display:{to:0}}).display.to;e.forEach(c=>{const d=t.find(g=>String(g.id)===String(c));if(!d)return;const p=d.playbackRate||1;let h;(d.type==="video"||d.type==="audio")&&d.trim?h=(d.trim.to-d.trim.from)/p:h=d.display.to-d.display.from,d.display.from=u,d.display.to=u+h,u=u+h})}async function Fa(t,r,e={}){var m;const n=C(t),s=r.trackItems.map(I=>Da(I,{size:n.size})),a=await Promise.all(s);(m=r.tracks)==null||m.forEach(I=>{Na(a,{idTrack:I.id,idItems:I.items},n)});const u=ii(r.tracks,r.trackItems),c=[],d=a.map(I=>I.id);r.trackItems.forEach(I=>{if(I.type!=="template")return;n.trackItemsMap={...n.trackItemsMap,...I.trackItemsMap},n.transitionsMap={...n.transitionsMap,...I.transitionsMap};const k={id:I.id,items:I.trackItemIds,transitions:I.transitionsIds||[],tracks:I.tracks};c.push(k)});const p=[],h={};return a.forEach(I=>{p.push(I.id),h[I.id]=I}),u.map(I=>si(n.tracks,[I])?I:null).forEach((I,k)=>{if(I)n.tracks.forEach(b=>{b.id===I.id&&(b.items=b.items.concat(I.items),b.magnetic&&q([b],n.trackItemsMap,d))});else{const b=e.trackIndex||0,S=u[k],f=Math.min(Math.max(b,0),n.tracks.length);n.tracks.splice(f,0,S)}}),n.trackItemsMap={...n.trackItemsMap,...h},n.trackItemIds=[...n.trackItemIds,...p],n.structure=[...n.structure,...c],n.duration=Y(n.trackItemsMap),{trackItemIds:n.trackItemIds,trackItemsMap:n.trackItemsMap,tracks:n.tracks,duration:n.duration,structure:n.structure,transitionIds:n.transitionIds,transitionsMap:n.transitionsMap}}function bt(t,r,e={isNewTrack:!0}){const n=r.map(u=>u.id),s=[],a={};if(r.forEach(u=>{s.push(u.id),a[u.id]=u}),(e.targetTrackIndex!==void 0||e.targetTrackId)&&!e.isNewTrack){const u=e.targetTrackIndex||0,c=e.targetTrackId;let d=t.tracks[u];if(c&&(d=t.tracks.find(p=>p.id===c)),!d)throw new Error("Target track not found");d.items.push(...s)}else{const u={id:Hr(),accepts:Object.keys(jr()),type:r[0].type,items:n,magnetic:!1,static:!1,muted:!1};t.tracks.splice(e.targetTrackIndex||0,0,u)}return t.trackItemsMap={...t.trackItemsMap,...a},t.trackItemIds=[...t.trackItemIds,...s],t}async function $a(t,r,e={}){const n=C(t),s=[ti(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})],a=await Promise.all(s),u=a.map(p=>p.id),c=bt(n,a,e),d=c.tracks.filter(p=>p.magnetic);return q(d,c.trackItemsMap,u),c.duration=Y(c.trackItemsMap),{trackItemIds:c.trackItemIds,trackItemsMap:c.trackItemsMap,tracks:c.tracks,duration:c.duration}}async function Ha(t,r,e={}){const n=C(t),s=[Js(r)],a=await Promise.all(s),u=a.map(p=>p.id),c=bt(n,a,e);c.duration=Y(c.trackItemsMap);const d=c.tracks.filter(p=>p.magnetic);return q(d,c.trackItemsMap,u),{trackItemIds:c.trackItemIds,trackItemsMap:c.trackItemsMap,tracks:c.tracks,duration:c.duration}}async function Ua(t,r,e={}){const n=C(t),s=[qs(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})],a=await Promise.all(s),u=a.map(p=>p.id),c=bt(n,a,e);c.duration=Y(c.trackItemsMap);const d=c.tracks.filter(p=>p.magnetic);return q(d,c.trackItemsMap,u),{trackItemIds:c.trackItemIds,trackItemsMap:c.trackItemsMap,tracks:c.tracks,duration:c.duration}}async function ja(t,r,e={}){const n=C(t),s=[ri(r,{size:e.size})],a=await Promise.all(s),u=a.map(p=>p.id),c=bt(n,a,e);c.duration=Y(c.trackItemsMap);const d=c.tracks.filter(p=>p.magnetic);return q(d,c.trackItemsMap,u),{trackItemIds:c.trackItemIds,trackItemsMap:c.trackItemsMap,tracks:c.tracks,duration:c.duration}}async function Ba(t,r,e={}){const n=C(t),s=[Ma(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})],a=await Promise.all(s),u=a.map(p=>p.id),c=bt(n,a,e);c.duration=Y(c.trackItemsMap);const d=c.tracks.filter(p=>p.magnetic);return q(d,c.trackItemsMap,u),{trackItemIds:c.trackItemIds,trackItemsMap:c.trackItemsMap,tracks:c.tracks,duration:c.duration}}async function Ya(t,r,e={}){const n=C(t),s=[Qs(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})],a=await Promise.all(s),u=a.map(p=>p.id),c=bt(n,a,e);c.duration=Y(c.trackItemsMap);const d=c.tracks.filter(p=>p.magnetic);return q(d,c.trackItemsMap,u),{trackItemIds:c.trackItemIds,trackItemsMap:c.trackItemsMap,tracks:c.tracks,duration:c.duration}}async function Wa(t,r,e={}){const n=C(t),s="composition",a=r.trackItemsMap,u=r.trackItemIds,c=r.tracks||[],d=r.trackItemDetailsMap,{details:p,...h}=await Aa(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio}),g={id:h.id,items:u,transitions:[],tracks:c},I=[{...h,type:s,details:p}],k=bt(n,I,e);k.trackItemsMap={...k.trackItemsMap,...a,[h.id]:{...h,type:s,details:p}},k.structure=[...k.structure,g],k.duration=Y(k.trackItemsMap);const b=k.tracks.filter(S=>S.magnetic);return q(b,k.trackItemsMap,[h.id]),d&&Object.keys(d).forEach(S=>{k.trackItemsMap[S]={...k.trackItemsMap[S],details:{...d[S].details}}}),{trackItemIds:k.trackItemIds,trackItemsMap:k.trackItemsMap,tracks:k.tracks,duration:k.duration,structure:k.structure}}async function re(t,r,e={},n){const s=C(t),a=g=>g.display?g.display:{from:0,to:s.duration},u=[];n==="progress-bar"&&u.push(Sa(r,{size:s.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})),n==="progress-frame"&&u.push(Ta(r,{size:s.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})),n==="radial-audio-bars"&&(r.display=a(r),u.push(Ea(r,{size:s.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio}))),n==="lineal-audio-bars"&&(r.display=a(r),u.push(Wr(r,{size:s.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio}))),n==="wave-audio-bars"&&(r.display=a(r),u.push(Wr(r,{size:s.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio}))),n==="hill-audio-bars"&&(r.display=a(r),u.push(Wr(r,{size:s.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio}))),n==="progress-square"&&u.push(wa(r,{size:s.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio}));const c=await Promise.all(u),d=c.map(g=>g.id),p=bt(s,c,e);p.duration=Y(p.trackItemsMap);const h=p.tracks.filter(g=>g.magnetic);return q(h,p.trackItemsMap,d),{trackItemIds:p.trackItemIds,trackItemsMap:p.trackItemsMap,tracks:p.tracks,duration:p.duration}}async function Ga(t,r,e={}){const n=C(t),s="template",a=r.trackItemsMap,u=r.trackItemIds,c=r.transitionsMap,d=r.transitionIds||[],p=r.tracks||[],h=r.structure||[],{details:g,...m}=await Zs(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio}),I={id:m.id,items:u,transitions:d,tracks:p},b=[{...m,type:s,details:g}],S=bt(n,b,e);S.transitionIds=[...S.transitionIds,...d],S.transitionsMap={...S.transitionsMap,...c},S.trackItemsMap={...S.trackItemsMap,...a,[m.id]:{...m,type:s,details:g}},S.structure=[...S.structure,I,...h],S.duration=Y(S.trackItemsMap);const f=S.tracks.filter(_=>_.magnetic);return q(f,S.trackItemsMap,[m.id]),{trackItemIds:S.trackItemIds,trackItemsMap:S.trackItemsMap,tracks:S.tracks,duration:S.duration,structure:S.structure,transitionsMap:S.transitionsMap}}async function Xa(t,r,e={}){const n=C(t),s=r.trackItems.map(g=>ei(g,{size:e.size})),a=await Promise.all(s),u=ii(r.tracks,r.trackItems),c=[],d={};if(a.forEach(g=>{const{details:m,...I}=g;c.push(g.id),d[g.id]=I}),si(n.tracks,u))n.tracks.forEach(g=>{u.forEach(m=>{g.id===m.id&&(g.magnetic&&q([g],n.trackItemsMap,c),g.items.push(...c))})});else{const g=e.trackIndex||0,m=Math.min(Math.max(g,0),n.tracks.length);n.tracks.splice(m,0,...u)}n.trackItemsMap={...n.trackItemsMap,...d},n.trackItemIds=[...n.trackItemIds,...c],n.duration=Y(n.trackItemsMap);const h=n.tracks.filter(g=>g.magnetic);return q(h,n.trackItemsMap,c),{trackItemIds:n.trackItemIds,trackItemsMap:n.trackItemsMap,tracks:n.tracks,duration:n.duration}}async function Ka(t,r){const e=C(t),n=e.trackItemsMap[r.id],s=[];if(!n)return{};let a=n.animations||{};return r.animations.loop?r.animations.loop.composition.forEach(u=>{var c;(c=u.details)!=null&&c.fonts&&s.push(...u.details.fonts)}):r.animations.in?r.animations.in.composition.forEach(u=>{var c;(c=u.details)!=null&&c.fonts&&s.push(...u.details.fonts)}):r.animations.out?r.animations.out.composition.forEach(u=>{var c;(c=u.details)!=null&&c.fonts&&s.push(...u.details.fonts)}):r.animations.timed&&r.animations.timed.composition.forEach(u=>{var c;(c=u.details)!=null&&c.fonts&&s.push(...u.details.fonts)}),s.length>0&&await Ee(s),a.in&&r.animations.in?a.in=r.animations.in:a.out&&r.animations.out?a.out=r.animations.out:a.loop&&r.animations.loop?a.loop=r.animations.loop:!a.out&&r.animations.out?a.out=r.animations.out:!a.in&&r.animations.in?a.in=r.animations.in:!a.loop&&r.animations.loop?a.loop=r.animations.loop:a=r.animations,(r.animations.in||r.animations.out||r.animations.loop)&&delete a.timed,r.animations.timed&&(a.timed=r.animations.timed,delete a.in,delete a.out,delete a.loop),n.animations=a,{trackItemsMap:e.trackItemsMap}}async function Va(t,r,e={}){const n=C(t),s=[Oa(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})],a=await Promise.all(s),u=a.map(p=>p.id),c=bt(n,a,e);c.duration=Y(c.trackItemsMap);const d=c.tracks.filter(p=>p.magnetic);return q(d,c.trackItemsMap,u),{trackItemIds:c.trackItemIds,trackItemsMap:c.trackItemsMap,tracks:c.tracks,duration:c.duration}}async function qa(t,r){const e=C(t),n=e.tracks,s=Object.keys(r);if(!s.length)return e;for(const u of s)e.tracks=n.map(c=>{if(c.id===u){const d=r[u]||{};c={...c,magnetic:d.magnetic!==void 0?d.magnetic:c.magnetic,muted:d.muted!==void 0?d.muted:c.muted}}return c});if(e.tracks.some(u=>u.magnetic)){const u=e.tracks.filter(c=>c.magnetic);q(u,e.trackItemsMap,[])}const a=Y(e.trackItemsMap);return{...e,duration:a}}function Ja(t){const r=H.subject.pipe(H.filter(({key:f})=>f.startsWith(Fr))),e=H.subject.pipe(H.filter(({key:f})=>f.startsWith(fr))),n=H.subject.pipe(H.filter(({key:f})=>f.startsWith(j))),s=H.subject.pipe(H.filter(({key:f})=>f.startsWith(V))),a=H.subject.pipe(H.filter(({key:f})=>f.startsWith(Ye))),u=H.subject.pipe(H.filter(({key:f})=>f.startsWith(te))),c=H.subject.pipe(H.filter(({key:f})=>f.startsWith(It))),d=H.subject.pipe(H.filter(({key:f})=>f.startsWith($r))),p=r.subscribe(async f=>{var _;if(f.key===Fr){const{actions:E}=(_=f.value)==null?void 0:_.payload;E.forEach(T=>{H.dispatch(T.type,T.payload&&{payload:T.payload})})}}),h=e.subscribe(async f=>{var _,E;if(f.key===is){const T=(_=f.value)==null?void 0:_.payload,M=await Ra(t.getState(),T);t.updateState(M,{kind:"design:load",updateHistory:!1})}if(f.key===as){const T=(E=f.value)==null?void 0:E.payload;t.updateState({size:T},{kind:"design:resize",updateHistory:!1})}}),g=a.subscribe(f=>{if(f.key===Ns)return t.undo();if(f.key===Fs)return t.redo()}),m=d.subscribe(f=>{var _;if(f.key===$s){const E=(_=f.value)==null?void 0:_.payload.scale;t.updateState({scale:E},{kind:"update",updateHistory:!1})}}),I=s.subscribe(async f=>{var _,E,T,M;if(f.key===Cs){const v=((_=f.value)==null?void 0:_.payload.trackItemIds)||[];t.updateState({activeIds:v},{kind:"update",updateHistory:!1})}if(f.key===Ps&&Ca(t.getState()),f.key===Ls){const v=(E=f.value)==null?void 0:E.payload.trackItemIds,A=fa(t.getState(),v);t.updateState(A,{updateHistory:!0,kind:"remove"})}if(f.key===xs){const v=ba(t.getState(),(T=f.value)==null?void 0:T.payload.trackItemIds);t.updateState(v,{updateHistory:!0,kind:"update"})}if(f.key===zs){const v=(M=f.value)==null?void 0:M.payload,A=await Ia(t.getState(),v);t.updateState(A,{updateHistory:!0,kind:"update:details"})}}),k=n.subscribe(async f=>{var U,P,K,D,F,nt,ce,ue,Ae,Me,Oe,De,z,Re,Ce,at,le,N,de,Pe,ot,fe,pe,Ht,Ut,he,jt,me,Bt,ge,xe,Le,Mt,Yt,ye,Ie,pt,Ot,ze,kt,Dt,Wt,st,be,ke,Ne,Gt,Rt,_e,Ct,_t,ct,Pt,Xt,vt,Kt,St,Vt,qt;const _=C(t.getState()),E=((P=(U=f.value)==null?void 0:U.options)==null?void 0:P.isSelected)||!1,T=(D=(K=f.value)==null?void 0:K.options)==null?void 0:D.scaleMode,M=(nt=(F=f.value)==null?void 0:F.options)==null?void 0:nt.scaleAspectRatio,v=(ue=(ce=f.value)==null?void 0:ce.options)==null?void 0:ue.trackIndex;let A={};f.key===ps?A=await Ka(_,(Ae=f.value)==null?void 0:Ae.payload):f.key===gs?A=await Fa(_,(Me=f.value)==null?void 0:Me.payload,{trackIndex:v}):f.key===hs?A=await Xa(_,(Oe=f.value)==null?void 0:Oe.payload,{trackIndex:v}):f.key===os?A=await ja(_,(De=f.value)==null?void 0:De.payload,{targetTrackIndex:v,targetTrackId:(z=f.value)==null?void 0:z.options.targetTrackId,size:_.size,isNewTrack:(Ce=(Re=f.value)==null?void 0:Re.options)==null?void 0:Ce.isNewTrack}):f.key===ms?A=await Ga(_,(at=f.value)==null?void 0:at.payload,{scaleMode:T,scaleAspectRatio:M,targetTrackIndex:v,targetTrackId:(N=(le=f.value)==null?void 0:le.options)==null?void 0:N.targetTrackId}):f.key===ds?A=await Ya(_,(de=f.value)==null?void 0:de.payload,{scaleMode:T,scaleAspectRatio:M,targetTrackIndex:v,targetTrackId:(Pe=f.value)==null?void 0:Pe.options.targetTrackId}):f.key===fs?A=await Ba(_,(ot=f.value)==null?void 0:ot.payload,{scaleMode:T,scaleAspectRatio:M,targetTrackIndex:v,targetTrackId:(fe=f.value)==null?void 0:fe.options.targetTrackId}):f.key===Es?A=await Va(_,(pe=f.value)==null?void 0:pe.payload,{scaleMode:T,scaleAspectRatio:M,targetTrackIndex:v,targetTrackId:(Ht=f.value)==null?void 0:Ht.options.targetTrackId}):f.key===ls?A=await $a(_,(Ut=f.value)==null?void 0:Ut.payload,{scaleMode:T,scaleAspectRatio:M,targetTrackIndex:v,targetTrackId:(he=f.value)==null?void 0:he.options.targetTrackId,isNewTrack:(me=(jt=f.value)==null?void 0:jt.options)==null?void 0:me.isNewTrack}):f.key===us?A=await Ha(_,(Bt=f.value)==null?void 0:Bt.payload,{targetTrackIndex:v,targetTrackId:(ge=f.value)==null?void 0:ge.options.targetTrackId,isNewTrack:(Le=(xe=f.value)==null?void 0:xe.options)==null?void 0:Le.isNewTrack}):f.key===cs?A=await Ua(_,(Mt=f.value)==null?void 0:Mt.payload,{scaleMode:T,scaleAspectRatio:M,targetTrackIndex:v,targetTrackId:(Yt=f.value)==null?void 0:Yt.options.targetTrackId,isNewTrack:(Ie=(ye=f.value)==null?void 0:ye.options)==null?void 0:Ie.isNewTrack}):f.key===ys?A=await Wa(_,(pt=f.value)==null?void 0:pt.payload,{scaleMode:T,scaleAspectRatio:M,targetTrackIndex:v,targetTrackId:(Ot=f.value)==null?void 0:Ot.options.targetTrackId}):f.key===Is?A=await re(_,(ze=f.value)==null?void 0:ze.payload,{targetTrackIndex:v,targetTrackId:(Dt=(kt=f.value)==null?void 0:kt.options)==null?void 0:Dt.targetTrackId},"progress-bar"):f.key===vs?A=await re(_,(Wt=f.value)==null?void 0:Wt.payload,{targetTrackIndex:v,targetTrackId:(be=(st=f.value)==null?void 0:st.options)==null?void 0:be.targetTrackId},"progress-square"):f.key===bs?A=await re(_,(ke=f.value)==null?void 0:ke.payload,{targetTrackIndex:v,targetTrackId:(Gt=(Ne=f.value)==null?void 0:Ne.options)==null?void 0:Gt.targetTrackId},"progress-frame"):f.key===ks?A=await re(_,(Rt=f.value)==null?void 0:Rt.payload,{targetTrackIndex:v,targetTrackId:(Ct=(_e=f.value)==null?void 0:_e.options)==null?void 0:Ct.targetTrackId},"radial-audio-bars"):f.key===_s?A=await re(_,(_t=f.value)==null?void 0:_t.payload,{targetTrackIndex:v,targetTrackId:(Pt=(ct=f.value)==null?void 0:ct.options)==null?void 0:Pt.targetTrackId},"lineal-audio-bars"):f.key===Ss?A=await re(_,(Xt=f.value)==null?void 0:Xt.payload,{targetTrackIndex:v,targetTrackId:(Kt=(vt=f.value)==null?void 0:vt.options)==null?void 0:Kt.targetTrackId},"wave-audio-bars"):f.key===Ts&&(A=await re(_,(St=f.value)==null?void 0:St.payload,{targetTrackIndex:v,targetTrackId:(qt=(Vt=f.value)==null?void 0:Vt.options)==null?void 0:qt.targetTrackId},"hill-audio-bars")),E&&A.trackItemIds&&(A.activeIds=A.trackItemIds),t.updateState(A,{updateHistory:!0,kind:"add"})}),b=u.subscribe(async f=>{var _;if(f.key===Rs){const E=(_=f.value)==null?void 0:_.options.time,T=Pa(t.getState(),E);Object.keys(T).length>0&&t.updateState(T,{updateHistory:!0,kind:"update"})}if(f.key===Ds){const E=await ma(t.getState());t.updateState(E,{updateHistory:!0,kind:"update"})}}),S=c.subscribe(async f=>{var _,E,T,M;if(f.key===ws){const v=await xa(t.getState(),(_=f.value)==null?void 0:_.payload);t.updateState(v,{updateHistory:!0,kind:"update:details"})}if(f.key===Os){const v=await qa(t.getState(),(E=f.value)==null?void 0:E.payload);t.updateState(v,{updateHistory:!0,kind:"edit:track"})}if(f.key===As){const v=await La(t.getState(),(T=f.value)==null?void 0:T.payload);t.updateState(v,{updateHistory:!0,kind:"update:details"})}if(f.key===Ms){const v=za(t.getState(),(M=f.value)==null?void 0:M.payload);t.updateState(v,{updateHistory:!0,kind:"update:details"})}});return{unsubscribe:()=>{k.unsubscribe(),b.unsubscribe(),S.unsubscribe(),g.unsubscribe(),I.unsubscribe(),h.unsubscribe(),m.unsubscribe(),p.unsubscribe()}}}const Za={Date:!0,RegExp:!0,String:!0,Number:!0};function ai(t,r,e={cyclesFix:!0},n=[]){var c,d;let s=[];const a=Array.isArray(t);for(const p in t){const h=t[p],g=a?+p:p;if(!(p in r)){s.push({type:"REMOVE",path:[g],oldValue:t[p]});continue}const m=r[p],I=typeof h=="object"&&typeof m=="object"&&Array.isArray(h)===Array.isArray(m);h&&m&&I&&!Za[(d=(c=Object.getPrototypeOf(h))==null?void 0:c.constructor)==null?void 0:d.name]&&(!e.cyclesFix||!n.includes(h))?s.push.apply(s,ai(h,m,e,e.cyclesFix?n.concat([h]):[]).map(k=>(k.path.unshift(g),k))):h!==m&&!(Number.isNaN(h)&&Number.isNaN(m))&&!(I&&(isNaN(h)?h+""==m+"":+h==+m))&&s.push({path:[g],type:"CHANGE",value:m,oldValue:h})}const u=Array.isArray(r);for(const p in r)p in t||s.push({type:"CREATE",path:[u?+p:p],value:r[p]});return s}var Gr=Symbol.for("immer-nothing"),Xe=Symbol.for("immer-draftable"),dt=Symbol.for("immer-state"),oi=process.env.NODE_ENV!=="production"?[function(t){return`The plugin for '${t}' has not been loaded into Immer. To enable the plugin, import and call \`enable${t}()\` when initializing your application.`},function(t){return`produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${t}'`},"This object has been frozen and should not be mutated",function(t){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+t},"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.","Immer forbids circular references","The first or second argument to `produce` must be a function","The third argument to `produce` must be a function or undefined","First argument to `createDraft` must be a plain object, an array, or an immerable object","First argument to `finishDraft` must be a draft returned by `createDraft`",function(t){return`'current' expects a draft, got: ${t}`},"Object.defineProperty() cannot be used on an Immer draft","Object.setPrototypeOf() cannot be used on an Immer draft","Immer only supports deleting array indices","Immer only supports setting array indices and the 'length' property",function(t){return`'original' expects a draft, got: ${t}`}]:[];function G(t,...r){if(process.env.NODE_ENV!=="production"){const e=oi[t],n=typeof e=="function"?e.apply(null,r):e;throw new Error(`[Immer] ${n}`)}throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var ne=Object.getPrototypeOf;function se(t){return!!t&&!!t[dt]}function $t(t){var r;return t?ci(t)||Array.isArray(t)||!!t[Xe]||!!((r=t.constructor)!=null&&r[Xe])||qe(t)||Je(t):!1}var Qa=Object.prototype.constructor.toString();function ci(t){if(!t||typeof t!="object")return!1;const r=ne(t);if(r===null)return!0;const e=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return e===Object?!0:typeof e=="function"&&Function.toString.call(e)===Qa}function Ke(t,r){ie(t)===0?Reflect.ownKeys(t).forEach(e=>{r(e,t[e],t)}):t.forEach((e,n)=>r(n,e,t))}function ie(t){const r=t[dt];return r?r.type_:Array.isArray(t)?1:qe(t)?2:Je(t)?3:0}function Ve(t,r){return ie(t)===2?t.has(r):Object.prototype.hasOwnProperty.call(t,r)}function Xr(t,r){return ie(t)===2?t.get(r):t[r]}function ui(t,r,e){const n=ie(t);n===2?t.set(r,e):n===3?t.add(e):t[r]=e}function to(t,r){return t===r?t!==0||1/t===1/r:t!==t&&r!==r}function qe(t){return t instanceof Map}function Je(t){return t instanceof Set}function ae(t){return t.copy_||t.base_}function Kr(t,r){if(qe(t))return new Map(t);if(Je(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const e=ci(t);if(r===!0||r==="class_only"&&!e){const n=Object.getOwnPropertyDescriptors(t);delete n[dt];let s=Reflect.ownKeys(n);for(let a=0;a<s.length;a++){const u=s[a],c=n[u];c.writable===!1&&(c.writable=!0,c.configurable=!0),(c.get||c.set)&&(n[u]={configurable:!0,writable:!0,enumerable:c.enumerable,value:t[u]})}return Object.create(ne(t),n)}else{const n=ne(t);if(n!==null&&e)return{...t};const s=Object.create(n);return Object.assign(s,t)}}function Vr(t,r=!1){return mr(t)||se(t)||!$t(t)||(ie(t)>1&&(t.set=t.add=t.clear=t.delete=eo),Object.freeze(t),r&&Object.entries(t).forEach(([e,n])=>Vr(n,!0))),t}function eo(){G(2)}function mr(t){return Object.isFrozen(t)}var qr={};function oe(t){const r=qr[t];return r||G(0,t),r}function ro(t,r){qr[t]||(qr[t]=r)}var Ze;function li(){return Ze}function no(t,r){return{drafts_:[],parent_:t,immer_:r,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function di(t,r){r&&(oe("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=r)}function Jr(t){Zr(t),t.drafts_.forEach(so),t.drafts_=null}function Zr(t){t===Ze&&(Ze=t.parent_)}function fi(t){return Ze=no(Ze,t)}function so(t){const r=t[dt];r.type_===0||r.type_===1?r.revoke_():r.revoked_=!0}function pi(t,r){r.unfinalizedDrafts_=r.drafts_.length;const e=r.drafts_[0];return t!==void 0&&t!==e?(e[dt].modified_&&(Jr(r),G(4)),$t(t)&&(t=gr(r,t),r.parent_||yr(r,t)),r.patches_&&oe("Patches").generateReplacementPatches_(e[dt].base_,t,r.patches_,r.inversePatches_)):t=gr(r,e,[]),Jr(r),r.patches_&&r.patchListener_(r.patches_,r.inversePatches_),t!==Gr?t:void 0}function gr(t,r,e){if(mr(r))return r;const n=r[dt];if(!n)return Ke(r,(s,a)=>hi(t,n,r,s,a,e)),r;if(n.scope_!==t)return r;if(!n.modified_)return yr(t,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const s=n.copy_;let a=s,u=!1;n.type_===3&&(a=new Set(s),s.clear(),u=!0),Ke(a,(c,d)=>hi(t,n,s,c,d,e,u)),yr(t,s,!1),e&&t.patches_&&oe("Patches").generatePatches_(n,e,t.patches_,t.inversePatches_)}return n.copy_}function hi(t,r,e,n,s,a,u){if(process.env.NODE_ENV!=="production"&&s===e&&G(5),se(s)){const c=a&&r&&r.type_!==3&&!Ve(r.assigned_,n)?a.concat(n):void 0,d=gr(t,s,c);if(ui(e,n,d),se(d))t.canAutoFreeze_=!1;else return}else u&&e.add(s);if($t(s)&&!mr(s)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;gr(t,s),(!r||!r.scope_.parent_)&&typeof n!="symbol"&&Object.prototype.propertyIsEnumerable.call(e,n)&&yr(t,s)}}function yr(t,r,e=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&Vr(r,e)}function io(t,r){const e=Array.isArray(t),n={type_:e?1:0,scope_:r?r.scope_:li(),modified_:!1,finalized_:!1,assigned_:{},parent_:r,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let s=n,a=Qr;e&&(s=[n],a=Qe);const{revoke:u,proxy:c}=Proxy.revocable(s,a);return n.draft_=c,n.revoke_=u,c}var Qr={get(t,r){if(r===dt)return t;const e=ae(t);if(!Ve(e,r))return ao(t,e,r);const n=e[r];return t.finalized_||!$t(n)?n:n===tn(t.base_,r)?(rn(t),t.copy_[r]=nn(n,t)):n},has(t,r){return r in ae(t)},ownKeys(t){return Reflect.ownKeys(ae(t))},set(t,r,e){const n=mi(ae(t),r);if(n!=null&&n.set)return n.set.call(t.draft_,e),!0;if(!t.modified_){const s=tn(ae(t),r),a=s==null?void 0:s[dt];if(a&&a.base_===e)return t.copy_[r]=e,t.assigned_[r]=!1,!0;if(to(e,s)&&(e!==void 0||Ve(t.base_,r)))return!0;rn(t),en(t)}return t.copy_[r]===e&&(e!==void 0||r in t.copy_)||Number.isNaN(e)&&Number.isNaN(t.copy_[r])||(t.copy_[r]=e,t.assigned_[r]=!0),!0},deleteProperty(t,r){return tn(t.base_,r)!==void 0||r in t.base_?(t.assigned_[r]=!1,rn(t),en(t)):delete t.assigned_[r],t.copy_&&delete t.copy_[r],!0},getOwnPropertyDescriptor(t,r){const e=ae(t),n=Reflect.getOwnPropertyDescriptor(e,r);return n&&{writable:!0,configurable:t.type_!==1||r!=="length",enumerable:n.enumerable,value:e[r]}},defineProperty(){G(11)},getPrototypeOf(t){return ne(t.base_)},setPrototypeOf(){G(12)}},Qe={};Ke(Qr,(t,r)=>{Qe[t]=function(){return arguments[0]=arguments[0][0],r.apply(this,arguments)}}),Qe.deleteProperty=function(t,r){return process.env.NODE_ENV!=="production"&&isNaN(parseInt(r))&&G(13),Qe.set.call(this,t,r,void 0)},Qe.set=function(t,r,e){return process.env.NODE_ENV!=="production"&&r!=="length"&&isNaN(parseInt(r))&&G(14),Qr.set.call(this,t[0],r,e,t[0])};function tn(t,r){const e=t[dt];return(e?ae(e):t)[r]}function ao(t,r,e){var s;const n=mi(r,e);return n?"value"in n?n.value:(s=n.get)==null?void 0:s.call(t.draft_):void 0}function mi(t,r){if(!(r in t))return;let e=ne(t);for(;e;){const n=Object.getOwnPropertyDescriptor(e,r);if(n)return n;e=ne(e)}}function en(t){t.modified_||(t.modified_=!0,t.parent_&&en(t.parent_))}function rn(t){t.copy_||(t.copy_=Kr(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var oo=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(r,e,n)=>{if(typeof r=="function"&&typeof e!="function"){const a=e;e=r;const u=this;return function(d=a,...p){return u.produce(d,h=>e.call(this,h,...p))}}typeof e!="function"&&G(6),n!==void 0&&typeof n!="function"&&G(7);let s;if($t(r)){const a=fi(this),u=nn(r,void 0);let c=!0;try{s=e(u),c=!1}finally{c?Jr(a):Zr(a)}return di(a,n),pi(s,a)}else if(!r||typeof r!="object"){if(s=e(r),s===void 0&&(s=r),s===Gr&&(s=void 0),this.autoFreeze_&&Vr(s,!0),n){const a=[],u=[];oe("Patches").generateReplacementPatches_(r,s,a,u),n(a,u)}return s}else G(1,r)},this.produceWithPatches=(r,e)=>{if(typeof r=="function")return(u,...c)=>this.produceWithPatches(u,d=>r(d,...c));let n,s;return[this.produce(r,e,(u,c)=>{n=u,s=c}),n,s]},typeof(t==null?void 0:t.autoFreeze)=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof(t==null?void 0:t.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy)}createDraft(t){$t(t)||G(8),se(t)&&(t=co(t));const r=fi(this),e=nn(t,void 0);return e[dt].isManual_=!0,Zr(r),e}finishDraft(t,r){const e=t&&t[dt];(!e||!e.isManual_)&&G(9);const{scope_:n}=e;return di(n,r),pi(void 0,n)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}applyPatches(t,r){let e;for(e=r.length-1;e>=0;e--){const s=r[e];if(s.path.length===0&&s.op==="replace"){t=s.value;break}}e>-1&&(r=r.slice(e+1));const n=oe("Patches").applyPatches_;return se(t)?n(t,r):this.produce(t,s=>n(s,r))}};function nn(t,r){const e=qe(t)?oe("MapSet").proxyMap_(t,r):Je(t)?oe("MapSet").proxySet_(t,r):io(t,r);return(r?r.scope_:li()).drafts_.push(e),e}function co(t){return se(t)||G(10,t),gi(t)}function gi(t){if(!$t(t)||mr(t))return t;const r=t[dt];let e;if(r){if(!r.modified_)return r.base_;r.finalized_=!0,e=Kr(t,r.scope_.immer_.useStrictShallowCopy_)}else e=Kr(t,!0);return Ke(e,(n,s)=>{ui(e,n,gi(s))}),r&&(r.finalized_=!1),e}function yi(){process.env.NODE_ENV!=="production"&&oi.push('Sets cannot have "replace" patches.',function(m){return"Unsupported patch operation: "+m},function(m){return"Cannot apply patch, path doesn't resolve: "+m},"Patching reserved attributes like __proto__, prototype and constructor is not allowed");const r="replace",e="add",n="remove";function s(m,I,k,b){switch(m.type_){case 0:case 2:return u(m,I,k,b);case 1:return a(m,I,k,b);case 3:return c(m,I,k,b)}}function a(m,I,k,b){let{base_:S,assigned_:f}=m,_=m.copy_;_.length<S.length&&([S,_]=[_,S],[k,b]=[b,k]);for(let E=0;E<S.length;E++)if(f[E]&&_[E]!==S[E]){const T=I.concat([E]);k.push({op:r,path:T,value:g(_[E])}),b.push({op:r,path:T,value:g(S[E])})}for(let E=S.length;E<_.length;E++){const T=I.concat([E]);k.push({op:e,path:T,value:g(_[E])})}for(let E=_.length-1;S.length<=E;--E){const T=I.concat([E]);b.push({op:n,path:T})}}function u(m,I,k,b){const{base_:S,copy_:f}=m;Ke(m.assigned_,(_,E)=>{const T=Xr(S,_),M=Xr(f,_),v=E?Ve(S,_)?r:e:n;if(T===M&&v===r)return;const A=I.concat(_);k.push(v===n?{op:v,path:A}:{op:v,path:A,value:M}),b.push(v===e?{op:n,path:A}:v===n?{op:e,path:A,value:g(T)}:{op:r,path:A,value:g(T)})})}function c(m,I,k,b){let{base_:S,copy_:f}=m,_=0;S.forEach(E=>{if(!f.has(E)){const T=I.concat([_]);k.push({op:n,path:T,value:E}),b.unshift({op:e,path:T,value:E})}_++}),_=0,f.forEach(E=>{if(!S.has(E)){const T=I.concat([_]);k.push({op:e,path:T,value:E}),b.unshift({op:n,path:T,value:E})}_++})}function d(m,I,k,b){k.push({op:r,path:[],value:I===Gr?void 0:I}),b.push({op:r,path:[],value:m})}function p(m,I){return I.forEach(k=>{const{path:b,op:S}=k;let f=m;for(let M=0;M<b.length-1;M++){const v=ie(f);let A=b[M];typeof A!="string"&&typeof A!="number"&&(A=""+A),(v===0||v===1)&&(A==="__proto__"||A==="constructor")&&G(19),typeof f=="function"&&A==="prototype"&&G(19),f=Xr(f,A),typeof f!="object"&&G(18,b.join("/"))}const _=ie(f),E=h(k.value),T=b[b.length-1];switch(S){case r:switch(_){case 2:return f.set(T,E);case 3:G(16);default:return f[T]=E}case e:switch(_){case 1:return T==="-"?f.push(E):f.splice(T,0,E);case 2:return f.set(T,E);case 3:return f.add(E);default:return f[T]=E}case n:switch(_){case 1:return f.splice(T,1);case 2:return f.delete(T);case 3:return f.delete(k.value);default:return delete f[T]}default:G(17,S)}}),m}function h(m){if(!$t(m))return m;if(Array.isArray(m))return m.map(h);if(qe(m))return new Map(Array.from(m.entries()).map(([k,b])=>[k,h(b)]));if(Je(m))return new Set(Array.from(m).map(h));const I=Object.create(ne(m));for(const k in m)I[k]=h(m[k]);return Ve(m,Xe)&&(I[Xe]=m[Xe]),I}function g(m){return se(m)?h(m):m}ro("Patches",{applyPatches_:p,generatePatches_:s,generateReplacementPatches_:d})}var ft=new oo,uo=ft.produce;ft.produceWithPatches.bind(ft),ft.setAutoFreeze.bind(ft),ft.setUseStrictShallowCopy.bind(ft);var lo=ft.applyPatches.bind(ft);ft.createDraft.bind(ft),ft.finishDraft.bind(ft);var fo=9007199254740991,po="[object Arguments]",ho="[object Function]",mo="[object GeneratorFunction]",go="[object Symbol]",yo=typeof ht=="object"&&ht&&ht.Object===Object&&ht,Io=typeof self=="object"&&self&&self.Object===Object&&self,bo=yo||Io||Function("return this")();function ko(t,r,e){switch(e.length){case 0:return t.call(r);case 1:return t.call(r,e[0]);case 2:return t.call(r,e[0],e[1]);case 3:return t.call(r,e[0],e[1],e[2])}return t.apply(r,e)}function _o(t,r){for(var e=-1,n=t?t.length:0,s=Array(n);++e<n;)s[e]=r(t[e],e,t);return s}function vo(t,r){for(var e=-1,n=r.length,s=t.length;++e<n;)t[s+e]=r[e];return t}var sn=Object.prototype,So=sn.hasOwnProperty,an=sn.toString,Ii=bo.Symbol,To=sn.propertyIsEnumerable,bi=Ii?Ii.isConcatSpreadable:void 0,ki=Math.max;function Eo(t,r,e,n,s){var a=-1,u=t.length;for(e||(e=Oo),s||(s=[]);++a<u;){var c=t[a];e(c)?vo(s,c):s[s.length]=c}return s}function wo(t,r){return t=Object(t),Ao(t,r,function(e,n){return n in t})}function Ao(t,r,e){for(var n=-1,s=r.length,a={};++n<s;){var u=r[n],c=t[u];e(c,u)&&(a[u]=c)}return a}function Mo(t,r){return r=ki(r===void 0?t.length-1:r,0),function(){for(var e=arguments,n=-1,s=ki(e.length-r,0),a=Array(s);++n<s;)a[n]=e[r+n];n=-1;for(var u=Array(r+1);++n<r;)u[n]=e[n];return u[r]=a,ko(t,this,u)}}function Oo(t){return Co(t)||Ro(t)||!!(bi&&t&&t[bi])}function Do(t){if(typeof t=="string"||Fo(t))return t;var r=t+"";return r=="0"&&1/t==-1/0?"-0":r}function Ro(t){return xo(t)&&So.call(t,"callee")&&(!To.call(t,"callee")||an.call(t)==po)}var Co=Array.isArray;function Po(t){return t!=null&&zo(t.length)&&!Lo(t)}function xo(t){return _i(t)&&Po(t)}function Lo(t){var r=No(t)?an.call(t):"";return r==ho||r==mo}function zo(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=fo}function No(t){var r=typeof t;return!!t&&(r=="object"||r=="function")}function _i(t){return!!t&&typeof t=="object"}function Fo(t){return typeof t=="symbol"||_i(t)&&an.call(t)==go}var $o=Mo(function(t,r){return t==null?{}:wo(t,_o(Eo(r),Do))}),Ho=$o;const vi=Nr(Ho),Uo={size:{width:1080,height:1920},fps:30,tracks:[],trackItemIds:[],trackItemsMap:{},transitionIds:[],transitionsMap:{},scale:{index:7,unit:300,zoom:1/300,segments:5},duration:0,activeIds:[],structure:[],background:{type:"color",value:"transparent"}},Si=["tracks","trackItemsMap","transitionIds","transitionsMap","trackItemIds","structure"];class jo{constructor(r,e){Qt(this,"stateSubject");Qt(this,"stateHistorySubject");Qt(this,"prevState");Qt(this,"background");Qt(this,"undos",[]);Qt(this,"redos",[]);Qt(this,"listener");const n=Object.assign({},Uo,r,e!=null&&e.scale?{scale:e.scale}:{});this.stateSubject=new ts(n),this.stateHistorySubject=new ts({handleRedo:!1,handleUndo:!1}),this.background=n.background,this.prevState=n,(e!=null&&e.cors||e!=null&&e.acceptsMap)&&ga({cors:e.cors,acceptsMap:e.acceptsMap}),this.initListeners()}initListeners(){Ja(this)}destroyListeners(){this.listener&&this.listener.unsubscribe()}purge(){this.destroyListeners()}updateHistory(r,e){const n=vi(r,Si),s=vi(this.getState(),Si),a=ai(s,n);a.length&&(this.undos.push({undos:a,type:e}),this.redos=[])}getStateHistory(){return this.stateHistorySubject.getValue()}subscribeHistory(r){return this.stateHistorySubject.subscribe(r)}getState(){return this.stateSubject.getValue()}subscribe(r){return this.stateSubject.subscribe(r)}updateState(r,e={updateHistory:!1}){const n=this.getState(),s={...C(n),...C(r)};B(n,s)||(e.updateHistory&&this.updateHistory(s,e.kind),this.prevState=n,this.stateSubject.next(s))}subscribeToUpdateStateDetails(r){return this.stateSubject.asObservable().subscribe(e=>{(!B(e.size,this.prevState.size)||!B(e.background,this.prevState.background))&&r({size:e.size,background:e.background})})}subscribeToScale(r){return this.stateSubject.asObservable().subscribe(e=>{B(e.scale,this.prevState.scale)||r({scale:e.scale})})}subscribeToFps(r){return this.stateSubject.asObservable().subscribe(e=>{e.fps!==this.prevState.fps&&r({fps:e.fps})})}subscribeToUpdateTrackItem(r){return this.stateSubject.asObservable().subscribe(e=>{B(e.trackItemsMap,this.prevState.trackItemsMap)||r({trackItemsMap:e.trackItemsMap})})}subscribeToUpdateAnimations(r){return this.stateSubject.asObservable().subscribe(e=>{const n=Object.keys(e.trackItemsMap).filter(s=>{const a=this.prevState.trackItemsMap[s],u=e.trackItemsMap[s];return a&&u&&!B(a.animations,u.animations)});r({trackItemsMap:e.trackItemsMap,changedAnimationIds:n})})}subscribeToUpdateTrackItemTiming(r){return this.stateSubject.asObservable().subscribe(e=>{if(!B(e.trackItemsMap,this.prevState.trackItemsMap)){const n=Object.keys(e.trackItemsMap).filter(a=>{const u=this.prevState.trackItemsMap[a],c=e.trackItemsMap[a];return u&&c&&!B(u.trim,c.trim)}),s=Object.keys(e.trackItemsMap).filter(a=>{const u=this.prevState.trackItemsMap[a],c=e.trackItemsMap[a];return u&&c&&!B(u.display,c.display)});r({trackItemsMap:e.trackItemsMap,changedTrimIds:n.length>0?n:void 0,changedDisplayIds:s.length>0?s:void 0})}})}subscribeToUpdateItemDetails(r){return this.stateSubject.asObservable().subscribe(e=>{Object.keys(e.trackItemsMap).some(s=>{const a=this.prevState.trackItemsMap[s],u=e.trackItemsMap[s];return a&&u&&!B(a.details,u.details)})&&r({trackItemsMap:e.trackItemsMap})})}subscribeToDuration(r){return this.stateSubject.asObservable().subscribe(e=>{e.duration!==this.prevState.duration&&r({duration:e.duration})})}subscribeToHistory(r){return this.stateHistorySubject.asObservable().subscribe(e=>{if(e.handleRedo){const n=this.undos[this.undos.length-1].type;r({...this.getState(),type:n}),this.stateHistorySubject.next({handleRedo:!1,handleUndo:!1})}if(e.handleUndo){const n=this.redos[this.redos.length-1].type;r({...this.getState(),type:n}),this.stateHistorySubject.next({handleRedo:!1,handleUndo:!1})}})}subscribeToAddOrRemoveItems(r){return this.stateSubject.asObservable().subscribe(e=>{const n=[...e.trackItemIds].sort(),s=[...this.prevState.trackItemIds].sort(),a=[...e.transitionIds].sort(),u=[...this.prevState.transitionIds].sort();(!B(n,s)||!B(a,u))&&r({trackItemIds:e.trackItemIds})})}subscribeToActiveIds(r){return this.stateSubject.asObservable().subscribe(e=>{B(e.activeIds,this.prevState.activeIds)||r({activeIds:e.activeIds})})}subscribeToTracks(r){return this.stateSubject.asObservable().subscribe(e=>{const n=e.tracks,a=this.prevState.tracks.map(c=>c.id),u=n.filter(c=>!a.includes(c.id));u.length&&r({tracks:e.tracks,changedTracks:u.map(c=>c.id)})})}subscribeToUpdateTracks(r){return this.stateSubject.asObservable().subscribe(e=>{B(e.tracks,this.prevState.tracks)||r({tracks:e.tracks,duration:e.duration,trackItemsMap:e.trackItemsMap})})}subscribeToState(r){return this.stateSubject.asObservable().subscribe(e=>{(!B(e.tracks,this.prevState.tracks)||!B(e.trackItemIds,this.prevState.trackItemIds)||!B(e.trackItemsMap,this.prevState.trackItemsMap)||!B(e.transitionIds,this.prevState.transitionIds)||!B(e.transitionsMap,this.prevState.transitionsMap)||!B(e.structure,this.prevState.structure))&&r({tracks:e.tracks,trackItemIds:e.trackItemIds,trackItemsMap:e.trackItemsMap,transitionIds:e.transitionIds,transitionsMap:e.transitionsMap,structure:e.structure})})}undo(){const r=this.undos.pop(),e=r==null?void 0:r.undos,n=r==null?void 0:r.type;if(!e||!n)return;yi();const{trackItemIds:s,tracks:a,transitionIds:u,transitionsMap:c,trackItemsMap:d,structure:p}=this.getState(),h=C({trackItemIds:s,tracks:a,transitionIds:u,transitionsMap:c,trackItemsMap:d,structure:p}),g=[],m=[],I=[],k=[],b=[],S=[];e.forEach(D=>{let F;const nt=D.path.slice(1);D.type==="CREATE"?F={path:nt,op:"remove",value:D.value}:D.type==="CHANGE"?F={path:nt,op:"replace",value:D.oldValue}:F={path:nt,op:"add",value:D.oldValue},D.path.includes("trackItemIds")?I.push(F):D.path.includes("transitionIds")?m.push(F):D.path.includes("trackItemsMap")?b.push(F):D.path.includes("transitionsMap")?k.push(F):D.path.includes("tracks")?g.push(F):D.path.includes("structure")&&S.push(F)});const f=this.applyPatch(h.tracks,g),_=this.applyPatch(h.transitionIds,m),E=this.applyPatch(h.trackItemIds,I),T=this.applyPatch(h.transitionsMap,k),M=this.applyPatch(h.trackItemsMap,b),v=this.applyPatch(h.structure,S),A=C({tracks:f,transitionIds:_,trackItemIds:E,transitionsMap:T,trackItemsMap:M,structure:v}),U=C(this.getState()),P={...U,...A};this.prevState=U,this.redos.push({redos:e,type:n});const K=Y(P.trackItemsMap);this.stateSubject.next({...P,duration:K}),this.stateHistorySubject.next({handleRedo:!1,handleUndo:!0}),this.updateState(P,{updateHistory:!1})}applyPatch(r,e){return e.reverse().reduce((n,s)=>uo(n,a=>{lo(a,[s])}),r)}redo(){const r=this.redos.pop(),e=r==null?void 0:r.redos,n=r==null?void 0:r.type;if(!e||!n)return;yi();const{trackItemIds:s,tracks:a,transitionIds:u,transitionsMap:c,trackItemsMap:d,structure:p}=this.getState(),h=C({trackItemIds:s,tracks:a,transitionIds:u,transitionsMap:c,trackItemsMap:d,structure:p}),g=[],m=[],I=[],k=[],b=[],S=[];e.forEach(D=>{let F;const nt=D.path.slice(1);D.type==="CREATE"?F={path:nt,op:"add",value:D.value}:D.type==="CHANGE"?F={path:nt,op:"replace",value:D.value}:F={path:nt,op:"remove",value:D.oldValue},D.path.includes("trackItemIds")?I.push(F):D.path.includes("transitionIds")?m.push(F):D.path.includes("trackItemsMap")?b.push(F):D.path.includes("transitionsMap")?k.push(F):D.path.includes("structure")?S.push(F):g.push(F)});const f=this.applyPatch(h.tracks,g),_=this.applyPatch(h.transitionIds,m),E=this.applyPatch(h.trackItemIds,I),T=this.applyPatch(h.transitionsMap,k),M=this.applyPatch(h.trackItemsMap,b),v=this.applyPatch(h.structure,S),A=C({tracks:f,transitionIds:_,trackItemIds:E,transitionsMap:T,trackItemsMap:M,structure:v}),U=C(this.getState()),P={...U,...A};this.prevState=U,this.undos.push({undos:e,type:n});const K=Y(P.trackItemsMap);this.stateSubject.next({...P,duration:K}),this.stateHistorySubject.next({handleRedo:!0,handleUndo:!1}),this.updateState(P,{updateHistory:!1})}toJSON(){const{fps:r,tracks:e,size:n,trackItemIds:s,transitionsMap:a,trackItemsMap:u,transitionIds:c}=this.getState();return{fps:r,tracks:e,size:n,trackItemIds:s,transitionsMap:a,trackItemsMap:u,transitionIds:c}}}w.ACTIVE_CLONE=Zi,w.ACTIVE_DELETE=Ji,w.ACTIVE_PASTE=Ds,w.ACTIVE_PREFIX=te,w.ACTIVE_SET=qi,w.ACTIVE_SPLIT=Rs,w.ADD_ANIMATION=ps,w.ADD_AUDIO=us,w.ADD_CAPTIONS=hs,w.ADD_COMPOSITION=ys,w.ADD_HILL_AUDIO_BARS=Ts,w.ADD_ILLUSTRATION=ds,w.ADD_IMAGE=ls,w.ADD_ITEMS=gs,w.ADD_LINEAL_AUDIO_BARS=_s,w.ADD_MASK=Bi,w.ADD_PLACEHOLDER=ji,w.ADD_PREFIX=j,w.ADD_PROGRESS_BAR=Is,w.ADD_PROGRESS_FRAME=bs,w.ADD_PROGRESS_SQUARE=vs,w.ADD_RADIAL_AUDIO_BARS=ks,w.ADD_RECT=Es,w.ADD_SHAPE=fs,w.ADD_SUFFIX=Fi,w.ADD_TEMPLATE=ms,w.ADD_TEXT=os,w.ADD_TRANSITION=Yi,w.ADD_VIDEO=cs,w.ADD_WAVE_AUDIO_BARS=Ss,w.BULK_PREFIX=ss,w.DELETE_TEMPLATE_ITEM=Ki,w.DESIGN_LOAD=is,w.DESIGN_PREFIX=fr,w.DESIGN_RESIZE=as,w.EDIT_BACKGROUND_EDITOR=Ms,w.EDIT_BULK=Fr,w.EDIT_OBJECT=ws,w.EDIT_PREFIX=It,w.EDIT_SHAPE=Gi,w.EDIT_TEMPLATE_ITEM=Xi,w.EDIT_TEXT=Wi,w.EDIT_TRACK=Os,w.ENTER_EDIT_MODE=Vi,w.HISTORY_PREFIX=Ye,w.HISTORY_REDO=Fs,w.HISTORY_RESET=ua,w.HISTORY_UNDO=Ns,w.LAYER_CLONE=xs,w.LAYER_COPY=Ps,w.LAYER_CUT=ca,w.LAYER_DELETE=Ls,w.LAYER_EDITING_NAME=ia,w.LAYER_HIDDEN=ta,w.LAYER_LOCKED=Qi,w.LAYER_MOVE=ea,w.LAYER_PASTE=aa,w.LAYER_PREFIX=V,w.LAYER_RENAME=sa,w.LAYER_REPLACE=zs,w.LAYER_SELECT=Cs,w.LAYER_SELECTION=ra,w.LAYER_SEND_TO=na,w.LAYER_SPLIT=oa,w.REPLACE_MEDIA=As,w.STATE_CHANGED=Ui,w.STATE_PREFIX=ns,w.TIMELINE_SCALE_CHANGED=$s,w.TIMELINE_SCALE_PREFIX=$r,w.TRACKS_CHANGED=$i,w.TRACK_ITEMS_CHANGED=Hi,w.TRACK_ITEMS_PREFIX=rs,w.TRACK_PREFIX=es,w.default=jo,w.getAcceptsMap=jr,Object.defineProperties(w,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
